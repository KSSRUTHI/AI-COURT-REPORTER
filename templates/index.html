<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Court Reporter - Indian Judiciary Portal</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.7.2/socket.io.min.js"></script>
    <style>
        /* Global Styles */
        :root {
            --saffron: #FF9933;
            --white: #FFFFFF;
            --green: #138808;
            --blue: #000080;
            --gold: #FFD700;
            --dark-blue: #000051;
            --light-blue: #534bae;
            --text-dark: #212121;
            --bg-light: #f8f9fa;
            --bg-card: #ffffff;
            --success: #4caf50;
            --warning: #ff9800;
            --danger: #f44336;
            --shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            --radius: 8px;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: var(--bg-light);
            color: var(--text-dark);
            line-height: 1.6;
        }

        .container {
            display: flex;
            min-height: 100vh;
        }

        /* Sidebar Styles */
        .sidebar {
            width: 250px;
            background-color: var(--blue);
            color: var(--white);
            padding: 1.5rem 1rem;
            box-shadow: var(--shadow);
            z-index: 100;
            position: fixed;
            height: 100vh;
            overflow-y: auto;
        }

        .logo {
            display: flex;
            align-items: center;
            margin-bottom: 2rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .logo i {
            font-size: 1.8rem;
            margin-right: 0.5rem;
            color: var(--gold);
        }

        .logo h1 {
            font-size: 1.4rem;
            font-weight: 600;
        }

        .nav-links {
            list-style: none;
        }

        .nav-links li {
            margin-bottom: 0.5rem;
        }

        .nav-links a {
            display: flex;
            align-items: center;
            padding: 0.8rem 1rem;
            color: var(--white);
            text-decoration: none;
            border-radius: var(--radius);
            transition: all 0.3s ease;
        }

        .nav-links a:hover, .nav-links a.active {
            background-color: var(--light-blue);
            color: white;
        }

        .nav-links i {
            margin-right: 0.8rem;
            font-size: 1.2rem;
        }

        .user-info {
            position: absolute;
            bottom: 1rem;
            left: 1rem;
            right: 1rem;
            padding: 1rem;
            background-color: var(--dark-blue);
            border-radius: var(--radius);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .user-details {
            display: flex;
            align-items: center;
        }

        .user-info i {
            font-size: 1.5rem;
            margin-right: 0.8rem;
            color: var(--gold);
        }

        .logout-btn {
            background: none;
            border: none;
            color: var(--white);
            cursor: pointer;
            font-size: 1.2rem;
            transition: all 0.3s ease;
        }

        .logout-btn:hover {
            color: var(--saffron);
        }

        /* Main Content Styles */
        .main-content {
            flex: 1;
            padding: 2rem;
            margin-left: 250px;
            overflow-y: auto;
        }

        .page-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
        }

        .page-title {
            font-size: 1.8rem;
            font-weight: 600;
            color: var(--blue);
        }

        /* Card Styles */
        .card {
            background-color: var(--bg-card);
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            border-top: 3px solid var(--saffron);
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            padding-bottom: 0.8rem;
            border-bottom: 1px solid rgba(0, 0, 0, 0.1);
        }

        .card-title {
            font-size: 1.3rem;
            font-weight: 600;
            color: var(--blue);
        }

        /* Dashboard Styles */
        .stats-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background-color: var(--bg-card);
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            padding: 1.5rem;
            text-align: center;
            border-top: 3px solid var(--green);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 15px rgba(0, 0, 0, 0.1);
        }

        .stat-value {
            font-size: 2.5rem;
            font-weight: 700;
            color: var(--blue);
            margin: 0.5rem 0;
        }

        .stat-label {
            font-size: 0.9rem;
            color: var(--text-dark);
            opacity: 0.7;
        }

        .dashboard-grid {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 1.5rem;
        }

        .ongoing-cases {
            margin-bottom: 1.5rem;
        }

        .case-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem;
            border: 1px solid rgba(0, 0, 0, 0.1);
            border-radius: var(--radius);
            margin-bottom: 1rem;
            transition: all 0.3s ease;
        }

        .case-item:hover {
            background-color: rgba(0, 0, 0, 0.02);
            transform: translateY(-2px);
        }

        .case-info h3 {
            font-size: 1.1rem;
            margin-bottom: 0.3rem;
        }

        .case-meta {
            font-size: 0.9rem;
            color: rgba(0, 0, 0, 0.6);
        }

        .status-badge {
            display: inline-block;
            padding: 0.3rem 0.8rem;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .status-in-progress {
            background-color: rgba(255, 152, 0, 0.2);
            color: var(--warning);
        }

        .status-adjourned {
            background-color: rgba(33, 150, 243, 0.2);
            color: #2196f3;
        }

        .status-closed {
            background-color: rgba(76, 175, 80, 0.2);
            color: var(--success);
        }

        .quick-actions {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 1rem;
        }

        .action-card {
            background-color: var(--bg-card);
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            padding: 1.5rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            border-top: 3px solid var(--saffron);
        }

        .action-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
        }

        .action-icon {
            font-size: 2rem;
            color: var(--blue);
            margin-bottom: 1rem;
        }

        .action-title {
            font-weight: 600;
            margin-bottom: 0.5rem;
        }

        .action-desc {
            font-size: 0.9rem;
            color: rgba(0, 0, 0, 0.6);
        }

        .ai-insight {
            background-color: var(--blue);
            color: white;
            border-radius: var(--radius);
            padding: 1.5rem;
            margin-top: 1.5rem;
            border-top: 3px solid var(--gold);
        }

        .ai-insight h3 {
            margin-bottom: 1rem;
            font-size: 1.2rem;
        }

        /* Login Page Styles */
        .login-container {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background: linear-gradient(135deg, var(--saffron) 0%, var(--white) 33%, var(--white) 66%, var(--green) 100%);
        }

        .login-card {
            background-color: white;
            border-radius: var(--radius);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            padding: 2.5rem;
            width: 100%;
            max-width: 450px;
            text-align: center;
            border-top: 5px solid var(--saffron);
            border-bottom: 5px solid var(--green);
        }

        .emblem-container {
            margin-bottom: 1.5rem;
        }

        .emblem {
            width: 120px;
            height: 120px;
            background: linear-gradient(135deg, var(--saffron) 0%, var(--white) 33%, var(--white) 66%, var(--green) 100%);
            border-radius: 50%;
            margin: 0 auto;
            display: flex;
            justify-content: center;
            align-items: center;
            border: 3px solid var(--blue);
            position: relative;
            overflow: hidden;
        }

        .emblem::before {
            content: "";
            position: absolute;
            width: 80px;
            height: 80px;
            background-color: var(--blue);
            border-radius: 50%;
        }

        .emblem::after {
            content: "";
            position: absolute;
            width: 80px;
            height: 80px;
            background: transparent;
            border-radius: 50%;
        }

        .ashoka-chakra {
            position: absolute;
            width: 80px;
            height: 80px;
            background: transparent;
            border-radius: 50%;
            z-index: 2;
        }

        .spoke {
            position: absolute;
            width: 2px;
            height: 40px;
            background: white;
            top: 0;
            left: 50%;
            transform-origin: 50% 40px;
        }

        .login-logo {
            display: flex;
            justify-content: center;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .login-logo i {
            font-size: 2.5rem;
            color: var(--blue);
            margin-right: 0.8rem;
        }

        .login-logo h1 {
            font-size: 1.8rem;
            color: var(--blue);
        }

        .login-subtitle {
            color: rgba(0, 0, 0, 0.6);
            margin-bottom: 2rem;
        }

        .role-selection {
            display: flex;
            flex-direction: column;
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .role-option {
            display: flex;
            align-items: center;
            padding: 1rem 1.5rem;
            border: 2px solid rgba(0, 0, 0, 0.1);
            border-radius: var(--radius);
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .role-option:hover {
            border-color: var(--blue);
            background-color: rgba(0, 0, 128, 0.05);
        }

        .role-option i {
            font-size: 1.5rem;
            margin-right: 1rem;
            color: var(--blue);
        }

        .role-name {
            font-weight: 600;
            font-size: 1.1rem;
        }

        .login-btn {
            display: block;
            width: 100%;
            padding: 1rem;
            background-color: var(--blue);
            color: white;
            border: none;
            border-radius: var(--radius);
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .login-btn:hover {
            background-color: var(--dark-blue);
        }

        /* Table Styles */
        .data-table {
            width: 100%;
            border-collapse: collapse;
        }

        .data-table th, .data-table td {
            padding: 1rem;
            text-align: left;
            border-bottom: 1px solid rgba(0, 0, 0, 0.1);
        }

        .data-table th {
            background-color: rgba(0, 0, 0, 0.03);
            font-weight: 600;
            color: var(--blue);
        }

        .data-table tr:hover {
            background-color: rgba(0, 0, 0, 0.02);
        }

        .btn {
            display: inline-block;
            padding: 0.5rem 1rem;
            background-color: var(--blue);
            color: white;
            border: none;
            border-radius: var(--radius);
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn:hover {
            background-color: var(--dark-blue);
        }

        .btn-outline {
            background-color: transparent;
            border: 1px solid var(--blue);
            color: var(--blue);
        }

        .btn-outline:hover {
            background-color: var(--blue);
            color: white;
        }

        /* Transcription Panel Styles */
        .transcription-panel {
            display: flex;
            flex-direction: column;
            height: 70vh;
        }

        .transcript-container {
            flex: 1;
            border: 1px solid rgba(0, 0, 0, 0.1);
            border-radius: var(--radius);
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            overflow-y: auto;
            background-color: #f9f9f9;
        }

        .transcript-placeholder {
            text-align: center;
            color: rgba(0, 0, 0, 0.5);
            padding: 2rem;
        }

        .transcript-placeholder i {
            font-size: 3rem;
            margin-bottom: 1rem;
            color: rgba(0, 0, 0, 0.3);
        }

        .transcription-controls {
            display: flex;
            gap: 1rem;
        }

        .control-btn {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 1.5rem;
            background-color: var(--bg-card);
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .control-btn:hover {
            transform: translateY(-5px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
        }

        .control-btn i {
            font-size: 2.5rem;
            margin-bottom: 1rem;
            color: var(--blue);
        }

        .transcript-line {
            margin-bottom: 0.5rem;
            padding: 0.5rem;
            border-radius: 4px;
            animation: fadeIn 0.5s ease-in;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .transcript-line:nth-child(even) {
            background-color: rgba(0, 0, 0, 0.03);
        }

        .speaker-label {
            font-weight: bold;
            color: var(--blue);
        }

        .transcript-time {
            color: #666;
            font-size: 0.8rem;
            margin-right: 0.5rem;
        }

        .live-indicator {
            display: inline-block;
            width: 10px;
            height: 10px;
            background-color: var(--danger);
            border-radius: 50%;
            margin-right: 0.5rem;
            animation: pulse 1.5s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(0.95); opacity: 0.7; }
            50% { transform: scale(1.1); opacity: 1; }
            100% { transform: scale(0.95); opacity: 0.7; }
        }

        /* Chat AI Bot Styles */
        .chat-container {
            display: flex;
            flex-direction: column;
            height: 70vh;
        }

        .chat-messages {
            flex: 1;
            border: 1px solid rgba(0, 0, 0, 0.1);
            border-radius: var(--radius);
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            overflow-y: auto;
            background-color: #f9f9f9;
        }

        .message {
            margin-bottom: 1rem;
            padding: 0.8rem;
            border-radius: var(--radius);
            max-width: 80%;
        }

        .user-message {
            background-color: var(--blue);
            color: white;
            margin-left: auto;
        }

        .bot-message {
            background-color: #e9ecef;
            color: var(--text-dark);
        }

        .chat-input-container {
            display: flex;
            gap: 0.5rem;
        }

        .chat-input {
            flex: 1;
            padding: 0.8rem;
            border: 1px solid rgba(0, 0, 0, 0.1);
            border-radius: var(--radius);
        }

        .send-btn {
            padding: 0.8rem 1.5rem;
            background-color: var(--blue);
            color: white;
            border: none;
            border-radius: var(--radius);
            cursor: pointer;
        }

        /* Analytics Styles */
        .analytics-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1.5rem;
        }

        .chart-container {
            background-color: var(--bg-card);
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            padding: 1.5rem;
            height: 300px;
            display: flex;
            flex-direction: column;
        }

        .chart-title {
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 1rem;
            color: var(--blue);
        }

        .chart-placeholder {
            flex: 1;
            display: flex;
            justify-content: center;
            align-items: center;
            background-color: #f5f5f5;
            border-radius: var(--radius);
            color: rgba(0, 0, 0, 0.5);
        }

        /* Tone Analysis Specific Styles */
        .tone-analysis-grid {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 1.5rem;
            margin-bottom: 1.5rem;
        }

        .tone-summary-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: var(--radius);
            padding: 1.5rem;
        }

        .tone-metrics {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 1rem;
            margin-top: 1rem;
        }

        .tone-metric {
            text-align: center;
            padding: 1rem;
            background: rgba(255, 255, 255, 0.2);
            border-radius: var(--radius);
        }

        .tone-metric-value {
            font-size: 1.8rem;
            font-weight: bold;
            margin-bottom: 0.5rem;
        }

        .tone-metric-label {
            font-size: 0.9rem;
            opacity: 0.9;
        }

        .sentiment-breakdown {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1rem;
            margin-top: 1.5rem;
        }

        .sentiment-category {
            padding: 1rem;
            border-radius: var(--radius);
            text-align: center;
            color: white;
            font-weight: 600;
        }

        .sentiment-positive {
            background: linear-gradient(135deg, #4CAF50, #45a049);
        }

        .sentiment-negative {
            background: linear-gradient(135deg, #f44336, #da190b);
        }

        .sentiment-neutral {
            background: linear-gradient(135deg, #2196F3, #0b7dda);
        }

        .sentiment-mixed {
            background: linear-gradient(135deg, #FF9800, #e68900);
        }

        .tone-timeline-container {
            height: 400px;
        }

        .speaker-tone-comparison {
            height: 350px;
        }

        .tone-visualization {
            margin-top: 1rem;
            padding: 1rem;
            background: rgba(255, 255, 255, 0.1);
            border-radius: var(--radius);
        }

        .tone-bar {
            height: 20px;
            margin: 0.5rem 0;
            border-radius: 10px;
            position: relative;
            overflow: hidden;
        }

        .tone-bar-fill {
            height: 100%;
            border-radius: 10px;
            transition: width 0.5s ease;
        }

        .tone-bar-positive {
            background: linear-gradient(90deg, #4CAF50, #45a049);
        }

        .tone-bar-negative {
            background: linear-gradient(90deg, #f44336, #da190b);
        }

        .tone-bar-neutral {
            background: linear-gradient(90deg, #2196F3, #0b7dda);
        }

        /* Admin Dashboard Styles */
        .admin-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .system-status {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .status-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem;
            background-color: var(--bg-card);
            border-radius: var(--radius);
            box-shadow: var(--shadow);
        }

        .status-indicator {
            display: flex;
            align-items: center;
        }

        .status-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            margin-right: 0.5rem;
        }

        .status-operational {
            background-color: var(--success);
        }

        /* Transcript Display Styles */
        .transcript-display {
            background: white;
            border-radius: var(--radius);
            padding: 1.5rem;
            margin: 1rem 0;
            box-shadow: var(--shadow);
        }

        .segment-card {
            border: 1px solid #e0e0e0;
            border-radius: var(--radius);
            padding: 1rem;
            margin-bottom: 1rem;
            background: #fafafa;
        }

        .segment-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.5rem;
        }

        .segment-speaker {
            font-weight: bold;
            color: var(--blue);
        }

        .segment-time {
            color: #666;
            font-size: 0.9rem;
        }

        .segment-text {
            margin: 0.5rem 0;
            line-height: 1.5;
        }

        .segment-meta {
            display: flex;
            gap: 1rem;
            font-size: 0.8rem;
            color: #666;
        }

        .sentiment-indicator {
            display: inline-block;
            padding: 0.2rem 0.5rem;
            border-radius: 12px;
            font-size: 0.7rem;
        }

        .sentiment-positive {
            background: rgba(76, 175, 80, 0.2);
            color: var(--success);
        }

        .sentiment-negative {
            background: rgba(244, 67, 54, 0.2);
            color: var(--danger);
        }

        .sentiment-neutral {
            background: rgba(158, 158, 158, 0.2);
            color: #666;
        }

        .upload-status {
            padding: 1rem;
            margin: 1rem 0;
            border-radius: var(--radius);
        }

        .upload-success {
            background: rgba(76, 175, 80, 0.1);
            border: 1px solid var(--success);
            color: var(--success);
        }

        .upload-error {
            background: rgba(244, 67, 54, 0.1);
            border: 1px solid var(--danger);
            color: var(--danger);
        }

        /* Knowledge Graph Styles */
        .knowledge-graph-container {
            width: 100%;
            height: 500px;
            background: white;
            border-radius: var(--radius);
            position: relative;
            overflow: hidden;
        }

        .knowledge-graph-node {
            position: absolute;
            padding: 10px 15px;
            border-radius: 8px;
            font-size: 12px;
            font-weight: bold;
            text-align: center;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            cursor: pointer;
            transition: all 0.3s ease;
            z-index: 2;
            color: white;
            max-width: 150px;
            word-wrap: break-word;
        }

        .knowledge-graph-node:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }

        .knowledge-graph-node.central {
            background-color: var(--blue);
            width: 120px;
            height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .knowledge-graph-node.precedent {
            background-color: var(--light-blue);
            width: 140px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .knowledge-graph-connection {
            position: absolute;
            background-color: var(--blue);
            transform-origin: 0 0;
            z-index: 1;
        }

        /* Responsive Styles */
        @media (max-width: 992px) {
            .dashboard-grid {
                grid-template-columns: 1fr;
            }
            
            .analytics-grid {
                grid-template-columns: 1fr;
            }
            
            .tone-analysis-grid {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 768px) {
            .container {
                flex-direction: column;
            }
            
            .sidebar {
                width: 100%;
                position: static;
                height: auto;
            }
            
            .main-content {
                margin-left: 0;
            }
            
            .user-info {
                position: static;
                margin-top: 2rem;
            }
            
            .stats-container {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .tone-metrics {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 576px) {
            .stats-container {
                grid-template-columns: 1fr;
            }
            
            .quick-actions {
                grid-template-columns: 1fr;
            }
            
            .transcription-controls {
                flex-direction: column;
            }
            
            .sentiment-breakdown {
                grid-template-columns: 1fr;
            }
        }

        /* Enhanced Styles for Realistic Transcription */
        .typing-cursor {
            display: inline-block;
            width: 2px;
            height: 1.2em;
            background-color: var(--blue);
            margin-left: 2px;
            animation: blink 1s infinite;
        }

        @keyframes blink {
            0%, 100% {
                opacity: 1;
            }
            50% {
                opacity: 0;
            }
        }

        .loading-indicator {
            display: flex;
            align-items: center;
            color: var(--medium-gray);
        }

        .loading-indicator i {
            margin-right: 10px;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .download-btn {
            background-color: var(--green);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: var(--radius);
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .download-btn:hover {
            background-color: #0d6e07;
        }

        .speaker-judge {
            border-left: 4px solid var(--saffron);
        }

        .speaker-prosecution {
            border-left: 4px solid var(--blue);
        }

        .speaker-defense {
            border-left: 4px solid var(--green);
        }

        .speaker-witness {
            border-left: 4px solid var(--gold);
        }

        .quality-badge {
            display: inline-block;
            padding: 0.3rem 0.8rem;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            margin-left: 1rem;
        }

        .quality-high {
            background-color: rgba(76, 175, 80, 0.2);
            color: var(--success);
        }

        .quality-medium {
            background-color: rgba(255, 152, 0, 0.2);
            color: var(--warning);
        }

        .quality-low {
            background-color: rgba(244, 67, 54, 0.2);
            color: var(--danger);
        }

        .progress-bar {
            width: 100%;
            height: 6px;
            background-color: #e0e0e0;
            border-radius: 3px;
            overflow: hidden;
            margin: 1rem 0;
        }

        .progress-fill {
            height: 100%;
            background-color: var(--blue);
            transition: width 0.3s ease;
        }

        /* Enhanced Chat Animations */
        .typing-indicator {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 10px;
        }

        .thinking-cloud {
            display: flex;
            gap: 4px;
            align-items: center;
        }

        .cloud {
            width: 8px;
            height: 8px;
            background: var(--blue);
            border-radius: 50%;
            animation: cloudPulse 1.5s infinite ease-in-out;
        }

        .cloud:nth-child(2) {
            animation-delay: 0.2s;
        }

        .cloud:nth-child(3) {
            animation-delay: 0.4s;
        }

        @keyframes cloudPulse {
            0%, 100% {
                transform: scale(1);
                opacity: 0.7;
            }
            50% {
                transform: scale(1.2);
                opacity: 1;
            }
        }

        .thinking-text {
            color: var(--text-dark);
            font-style: italic;
            font-size: 0.9em;
        }

        /* Enhanced loading animation */
        @keyframes loadingProgress {
            0% {
                width: 0%;
            }
            50% {
                width: 70%;
            }
            100% {
                width: 100%;
            }
        }

        /* Message animations */
        .message {
            transition: all 0.3s ease;
        }

        .message.user-message {
            animation: slideInRight 0.3s ease;
        }

        .message.bot-message {
            animation: slideInLeft 0.3s ease;
        }

        @keyframes slideInRight {
            from {
                opacity: 0;
                transform: translateX(20px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        @keyframes slideInLeft {
            from {
                opacity: 0;
                transform: translateX(-20px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        /* Enhanced button states */
        .btn:disabled, .download-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none !important;
        }

        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background: white;
            border-radius: var(--radius);
            padding: 2rem;
            max-width: 90%;
            max-height: 90%;
            overflow-y: auto;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid #e0e0e0;
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: #666;
        }

        /* Precedent Details Styles */
        .precedent-details {
            padding: 1.5rem;
            background: white;
            border-radius: var(--radius);
            box-shadow: var(--shadow);
        }

        .precedent-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .precedent-title {
            font-size: 1.4rem;
            color: var(--blue);
            font-weight: 600;
        }

        .precedent-info {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .precedent-info-item {
            padding: 1rem;
            background: #f8f9fa;
            border-radius: var(--radius);
        }

        .precedent-info-label {
            font-weight: 600;
            color: var(--blue);
            margin-bottom: 0.5rem;
        }

        .precedent-summary {
            margin-bottom: 1.5rem;
            line-height: 1.6;
        }

        .precedent-key-points {
            margin-bottom: 1.5rem;
        }

        .key-points-list {
            list-style-type: none;
            padding-left: 0;
        }

        .key-points-list li {
            padding: 0.5rem 0;
            border-bottom: 1px solid #e0e0e0;
        }

        .key-points-list li:before {
            content: "•";
            color: var(--saffron);
            font-weight: bold;
            display: inline-block;
            width: 1em;
            margin-right: 0.5em;
        }

        .precedent-citations {
            margin-bottom: 1.5rem;
        }

        .citation-item {
            padding: 0.8rem;
            background: #f0f8ff;
            border-radius: var(--radius);
            margin-bottom: 0.5rem;
            border-left: 4px solid var(--blue);
        }

        .precedent-actions {
            display: flex;
            gap: 1rem;
            margin-top: 1.5rem;
        }

        /* Enhanced Dashboard Styles */
        .welcome-card {
            background: linear-gradient(135deg, var(--blue) 0%, var(--light-blue) 100%);
            color: white;
            border-radius: var(--radius);
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: var(--shadow);
        }

        .welcome-card h2 {
            margin-bottom: 0.5rem;
            font-size: 1.8rem;
        }

        .welcome-card p {
            opacity: 0.9;
            margin-bottom: 1rem;
        }

        .dashboard-section {
            margin-bottom: 2rem;
        }

        .section-title {
            font-size: 1.4rem;
            color: var(--blue);
            margin-bottom: 1rem;
            padding-bottom: 0.5rem;
            border-bottom: 2px solid var(--saffron);
        }

        .activity-timeline {
            list-style: none;
            padding-left: 0;
        }

        .activity-timeline li {
            padding: 0.8rem 0;
            border-bottom: 1px solid rgba(0, 0, 0, 0.1);
            display: flex;
            align-items: center;
        }

        .activity-timeline li:before {
            content: "•";
            color: var(--saffron);
            font-weight: bold;
            font-size: 1.5rem;
            margin-right: 0.8rem;
        }

        .activity-time {
            margin-left: auto;
            color: rgba(0, 0, 0, 0.6);
            font-size: 0.9rem;
        }

        .feature-highlight {
            display: flex;
            align-items: center;
            padding: 1rem;
            background: white;
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            margin-bottom: 1rem;
        }

        .feature-icon {
            font-size: 2rem;
            color: var(--blue);
            margin-right: 1rem;
        }

        .feature-content h3 {
            margin-bottom: 0.3rem;
            color: var(--blue);
        }

        .feature-content p {
            color: rgba(0, 0, 0, 0.7);
            font-size: 0.9rem;
        }

        /* Enhanced Analytics Styles */
        .metric-card {
            background: white;
            border-radius: var(--radius);
            padding: 1.5rem;
            box-shadow: var(--shadow);
            margin-bottom: 1.5rem;
            border-left: 4px solid var(--saffron);
        }

        .metric-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .metric-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--blue);
        }

        .metric-value {
            font-size: 2rem;
            font-weight: 700;
            color: var(--blue);
        }

        .metric-change {
            display: flex;
            align-items: center;
            font-size: 0.9rem;
        }

        .metric-change.positive {
            color: var(--success);
        }

        .metric-change.negative {
            color: var(--danger);
        }

        .metric-description {
            color: rgba(0, 0, 0, 0.6);
            font-size: 0.9rem;
        }

        .speaker-highlight {
            display: flex;
            align-items: center;
            padding: 1rem;
            background: white;
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            margin-bottom: 1rem;
        }

        .speaker-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: var(--blue);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            margin-right: 1rem;
        }

        .speaker-details {
            flex: 1;
        }

        .speaker-name {
            font-weight: 600;
            color: var(--blue);
        }

        .speaker-role {
            color: rgba(0, 0, 0, 0.6);
            font-size: 0.9rem;
        }

        .speaker-stats {
            text-align: right;
        }

        .speaker-stat-value {
            font-weight: 600;
            color: var(--blue);
        }

        .speaker-stat-label {
            font-size: 0.8rem;
            color: rgba(0, 0, 0, 0.6);
        }

        /* Enhanced Case Analytics Styles */
        .case-header {
            background: linear-gradient(135deg, var(--blue) 0%, var(--light-blue) 100%);
            color: white;
            border-radius: var(--radius);
            padding: 1.5rem;
            margin-bottom: 2rem;
        }

        .case-title {
            font-size: 1.5rem;
            margin-bottom: 0.5rem;
        }

        .case-subtitle {
            opacity: 0.9;
            margin-bottom: 1rem;
        }

        .case-meta {
            display: flex;
            gap: 2rem;
        }

        .case-meta-item {
            display: flex;
            flex-direction: column;
        }

        .case-meta-label {
            font-size: 0.8rem;
            opacity: 0.7;
        }

        .case-meta-value {
            font-size: 1.1rem;
            font-weight: 600;
        }

        .insight-card {
            background: white;
            border-radius: var(--radius);
            padding: 1.5rem;
            box-shadow: var(--shadow);
            margin-bottom: 1.5rem;
            border-left: 4px solid var(--green);
        }

        .insight-header {
            display: flex;
            align-items: center;
            margin-bottom: 1rem;
        }

        .insight-icon {
            font-size: 1.5rem;
            color: var(--green);
            margin-right: 0.8rem;
        }

        .insight-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--blue);
        }

        .insight-content {
            color: rgba(0, 0, 0, 0.7);
            line-height: 1.5;
        }

        .analysis-tabs {
            display: flex;
            border-bottom: 1px solid rgba(0, 0, 0, 0.1);
            margin-bottom: 1.5rem;
        }

        .analysis-tab {
            padding: 0.8rem 1.5rem;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            transition: all 0.3s ease;
        }

        .analysis-tab.active {
            border-bottom-color: var(--saffron);
            color: var(--blue);
            font-weight: 600;
        }

        .analysis-tab:hover {
            background-color: rgba(0, 0, 0, 0.02);
        }

        .analysis-content {
            display: none;
        }

        .analysis-content.active {
            display: block;
        }

        .comparison-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1.5rem;
        }

        .comparison-card {
            background: white;
            border-radius: var(--radius);
            padding: 1.5rem;
            box-shadow: var(--shadow);
        }

        .comparison-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--blue);
            margin-bottom: 1rem;
            text-align: center;
        }

        .comparison-value {
            font-size: 2rem;
            font-weight: 700;
            text-align: center;
            margin-bottom: 0.5rem;
        }

        .comparison-label {
            text-align: center;
            color: rgba(0, 0, 0, 0.6);
            font-size: 0.9rem;
        }

        .comparison-positive {
            color: var(--success);
        }

        .comparison-negative {
            color: var(--danger);
        }

        .comparison-neutral {
            color: var(--warning);
        }

        /* Enhanced Chart Containers */
        .chart-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1.5rem;
            margin-bottom: 1.5rem;
        }

        .chart-full-width {
            grid-column: 1 / -1;
        }

        .chart-tall {
            height: 400px;
        }

        .chart-medium {
            height: 300px;
        }

        .chart-small {
            height: 250px;
        }

        .chart-group {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1.5rem;
        }

        /* Enhanced Visualizations */
        .visualization-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
            margin-bottom: 1.5rem;
        }

        .visualization-card {
            background: white;
            border-radius: var(--radius);
            padding: 1.5rem;
            box-shadow: var(--shadow);
            display: flex;
            flex-direction: column;
        }

        .visualization-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .visualization-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--blue);
        }

        .visualization-content {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .heatmap-container {
            width: 100%;
            height: 300px;
            position: relative;
        }

        .timeline-container {
            width: 100%;
            height: 350px;
        }

        .radar-container {
            width: 100%;
            height: 300px;
        }

        .bubble-container {
            width: 100%;
            height: 350px;
        }

        .wordcloud-container {
            width: 100%;
            height: 300px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: #f8f9fa;
            border-radius: var(--radius);
        }

        .wordcloud-placeholder {
            text-align: center;
            color: rgba(0, 0, 0, 0.5);
        }

        .wordcloud-placeholder i {
            font-size: 3rem;
            margin-bottom: 1rem;
            color: rgba(0, 0, 0, 0.3);
        }

        .stat-highlight {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            padding: 1.5rem;
        }

        .stat-highlight-value {
            font-size: 2.5rem;
            font-weight: 700;
            color: var(--blue);
            margin-bottom: 0.5rem;
        }

        .stat-highlight-label {
            font-size: 0.9rem;
            color: rgba(0, 0, 0, 0.6);
        }

        .stat-highlight-change {
            font-size: 0.8rem;
            margin-top: 0.5rem;
        }

        .stat-highlight-change.positive {
            color: var(--success);
        }

        .stat-highlight-change.negative {
            color: var(--danger);
        }

        .analysis-section {
            margin-bottom: 2rem;
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .section-title {
            font-size: 1.3rem;
            color: var(--blue);
            font-weight: 600;
        }

        .section-actions {
            display: flex;
            gap: 0.5rem;
        }

        .trend-indicator {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.9rem;
        }

        .trend-up {
            color: var(--success);
        }

        .trend-down {
            color: var(--danger);
        }

        .trend-neutral {
            color: var(--warning);
        }
    </style>
</head>
<body>

    <!-- Login Page -->
    <div id="login-page" class="login-container">
        <div class="login-card">
            <div class="emblem-container">
                <div class="emblem">
                    <div class="ashoka-chakra" id="ashokaChakra">
                        <!-- Spokes will be generated by JavaScript -->
                    </div>
                </div>
            </div>
            <div class="login-logo">
                <i class="fas fa-balance-scale"></i>
                <h1>AI Court Reporter</h1>
            </div>
            <p class="login-subtitle">Indian Judiciary Portal</p>
            <h2>Select Your Role to Login</h2>
            
            <div class="role-selection">
                <div class="role-option" data-role="judge">
                    <i class="fas fa-gavel"></i>
                    <span class="role-name">Judge</span>
                </div>
                <div class="role-option" data-role="lawyer">
                    <i class="fas fa-user-tie"></i>
                    <span class="role-name">Lawyer</span>
                </div>
                <div class="role-option" data-role="clerk">
                    <i class="fas fa-user"></i>
                    <span class="role-name">Clerk</span>
                </div>
            </div>
            
            <button class="login-btn" id="login-btn">Login as Judge <i class="fas fa-arrow-right"></i></button>
        </div>
    </div>

    <!-- Main Application -->
    <div id="app" class="container" style="display: none;">
        <!-- Sidebar Navigation -->
        <div class="sidebar">
            <div class="logo">
                <i class="fas fa-balance-scale"></i>
                <h1>AI Court Reporter</h1>
            </div>
            
            <ul class="nav-links">
                <li><a href="#" class="nav-link active" data-page="dashboard"><i class="fas fa-tachometer-alt"></i> Dashboard</a></li>
                <li><a href="#" class="nav-link" data-page="live-transcription"><i class="fas fa-microphone"></i> Live Transcription</a></li>
                <li><a href="#" class="nav-link" data-page="transcripts"><i class="fas fa-file-alt"></i> Transcripts</a></li>
                <li><a href="#" class="nav-link" data-page="case-analytics"><i class="fas fa-chart-bar"></i> Case Analytics</a></li>
                <li><a href="#" class="nav-link" data-page="case-history"><i class="fas fa-history"></i> Case History</a></li>
                <li><a href="#" class="nav-link" data-page="reports"><i class="fas fa-file-alt"></i> Reports</a></li>
                <li><a href="#" class="nav-link" data-page="knowledge-graph"><i class="fas fa-project-diagram"></i> Knowledge Graph</a></li>
                <li><a href="#" class="nav-link" data-page="chat-aibot"><i class="fas fa-robot"></i> Chat AI Bot</a></li>
                <li><a href="#" class="nav-link" data-page="help"><i class="fas fa-question-circle"></i> Help</a></li>
                <li><a href="#" class="nav-link" data-page="admin"><i class="fas fa-cog"></i> Admin</a></li>
            </ul>
            
            <div class="user-info">
                <div class="user-details">
                    <i class="fas fa-user-circle"></i>
                    <div>
                        <div class="user-role">Judge</div>
                        <div class="user-name">Hon. Justice Sharma</div>
                    </div>
                </div>
                <button class="logout-btn" id="logout-btn" title="Logout">
                    <i class="fas fa-sign-out-alt"></i>
                </button>
            </div>
        </div>
        
        <!-- Main Content Area -->
        <div class="main-content">
            <!-- Dashboard Page -->
            <div id="dashboard-page" class="page">
                <div class="page-header">
                    <h1 class="page-title">Court Session Dashboard</h1>
                    <div class="date-display">
                        <i class="fas fa-calendar-alt"></i>
                        <span id="current-date">Loading...</span>
                    </div>
                </div>
                
                <!-- Welcome Card -->
                <div class="welcome-card">
                    <h2>Welcome, Hon. Justice Sharma</h2>
                    <p>Your AI-powered judicial assistant is ready to help with today's proceedings.</p>
                    <div class="quick-actions">
                        <div class="action-card" data-action="live-transcription">
                            <div class="action-icon">
                                <i class="fas fa-microphone"></i>
                            </div>
                            <div class="action-title">Start Live Session</div>
                            <div class="action-desc">Begin real-time transcription</div>
                        </div>
                        <div class="action-card" data-action="case-analytics">
                            <div class="action-icon">
                                <i class="fas fa-chart-bar"></i>
                            </div>
                            <div class="action-title">View Analytics</div>
                            <div class="action-desc">Case insights & trends</div>
                        </div>
                        <div class="action-card" data-action="reports">
                            <div class="action-icon">
                                <i class="fas fa-file-pdf"></i>
                            </div>
                            <div class="action-title">Generate Reports</div>
                            <div class="action-desc">Export case documentation</div>
                        </div>
                    </div>
                </div>
                
                <!-- Stats Overview -->
                <div class="stats-container">
                    <div class="stat-card">
                        <div class="stat-label">Today's Cases</div>
                        <div class="stat-value">5</div>
                        <div class="stat-change positive">
                            <i class="fas fa-arrow-up"></i> 2 from yesterday
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Active Sessions</div>
                        <div class="stat-value">2</div>
                        <div class="stat-change neutral">
                            <i class="fas fa-minus"></i> No change
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Pending Transcripts</div>
                        <div class="stat-value">3</div>
                        <div class="stat-change negative">
                            <i class="fas fa-arrow-down"></i> 1 resolved
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">AI Accuracy</div>
                        <div class="stat-value">94%</div>
                        <div class="stat-change positive">
                            <i class="fas fa-arrow-up"></i> 2% improvement
                        </div>
                    </div>
                </div>
                
                <div class="dashboard-grid">
                    <!-- Ongoing Cases -->
                    <div class="card">
                        <div class="card-header">
                            <h2 class="card-title">Today's Cases</h2>
                            <button class="btn btn-outline">View All</button>
                        </div>
                        
                        <div class="ongoing-cases">
                            <div class="case-item">
                                <div class="case-info">
                                    <h3>State vs. Rajesh Kumar</h3>
                                    <div class="case-meta">CR-2024-01567 • Courtroom 3 • 10:30 AM</div>
                                </div>
                                <div>
                                    <span class="status-badge status-in-progress">In Progress</span>
                                    <button class="btn join-hearing" data-case="CR-2024-01567" style="margin-left: 0.5rem;">Join</button>
                                </div>
                            </div>
                            
                            <div class="case-item">
                                <div class="case-info">
                                    <h3>Public Interest Foundation vs. Union of India</h3>
                                    <div class="case-meta">WP-2024-04557 • Courtroom 1 • 11:45 AM</div>
                                </div>
                                <div>
                                    <span class="status-badge status-adjourned">Adjourned</span>
                                    <button class="btn join-hearing" data-case="WP-2024-04557" style="margin-left: 0.5rem;">Details</button>
                                </div>
                            </div>
                            
                            <div class="case-item">
                                <div class="case-info">
                                    <h3>Anjali Verma vs. ABC Corp</h3>
                                    <div class="case-meta">CV-2024-09876 • Courtroom 2 • 2:15 PM</div>
                                </div>
                                <div>
                                    <span class="status-badge status-in-progress">Upcoming</span>
                                    <button class="btn join-hearing" data-case="CV-2024-09876" style="margin-left: 0.5rem;">Prepare</button>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Recent Activity -->
                    <div class="card">
                        <div class="card-header">
                            <h2 class="card-title">Recent Activity</h2>
                        </div>
                        
                        <ul class="activity-timeline">
                            <li>
                                <span>Transcript completed for State vs. Rajesh Kumar</span>
                                <span class="activity-time">10:15 AM</span>
                            </li>
                            <li>
                                <span>Tone analysis report generated</span>
                                <span class="activity-time">9:45 AM</span>
                            </li>
                            <li>
                                <span>New case assigned: CV-2024-11234</span>
                                <span class="activity-time">Yesterday</span>
                            </li>
                            <li>
                                <span>Legal precedent added to knowledge graph</span>
                                <span class="activity-time">Yesterday</span>
                            </li>
                            <li>
                                <span>System update completed</span>
                                <span class="activity-time">2 days ago</span>
                            </li>
                        </ul>
                    </div>
                </div>
                
                <!-- AI Insights -->
                <div class="ai-insight">
                    <h3><i class="fas fa-lightbulb"></i> AI Insight</h3>
                    <p>Based on recent proceedings, the AI has detected an increase in cases involving financial fraud (up 15% from last quarter). Consider prioritizing these cases as they typically have shorter hearing durations when addressed promptly.</p>
                </div>
                
                <!-- Feature Highlights -->
                <div class="dashboard-section">
                    <h2 class="section-title">Platform Features</h2>
                    
                    <div class="quick-actions">
                        <div class="feature-highlight">
                            <div class="feature-icon">
                                <i class="fas fa-microphone-alt"></i>
                            </div>
                            <div class="feature-content">
                                <h3>Real-time Transcription</h3>
                                <p>AI-powered speech-to-text with speaker identification and timestamps</p>
                            </div>
                        </div>
                        
                        <div class="feature-highlight">
                            <div class="feature-icon">
                                <i class="fas fa-chart-pie"></i>
                            </div>
                            <div class="feature-content">
                                <h3>Advanced Analytics</h3>
                                <p>Comprehensive tone analysis, sentiment tracking, and case insights</p>
                            </div>
                        </div>
                        
                        <div class="feature-highlight">
                            <div class="feature-icon">
                                <i class="fas fa-robot"></i>
                            </div>
                            <div class="feature-content">
                                <h3>AI Legal Assistant</h3>
                                <p>Instant answers to legal queries and precedent research</p>
                            </div>
                        </div>
                        
                        <div class="feature-highlight">
                            <div class="feature-icon">
                                <i class="fas fa-project-diagram"></i>
                            </div>
                            <div class="feature-content">
                                <h3>Knowledge Graph</h3>
                                <p>Visual mapping of legal precedents and case relationships</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Live Transcription Page -->
            <div id="live-transcription-page" class="page" style="display: none;">
                <div class="page-header">
                    <h1 class="page-title">Live Transcription Panel</h1>
                    <div>
                        <span id="transcription-status" class="status-badge status-adjourned">
                            <span class="live-indicator" style="display: none;"></span>
                            Not Started
                        </span>
                        <button id="stop-transcription" class="btn" style="display: none; margin-left: 1rem;">Stop Transcription</button>
                    </div>
                </div>
                
                <div class="card transcription-panel">
                    <div class="transcript-container" id="transcript-container">
                        <div class="transcript-placeholder" id="transcript-placeholder">
                            <i class="fas fa-file-audio"></i>
                            <h3>Transcript is Empty</h3>
                            <p>Start a live session or upload an audio file to begin.</p>
                        </div>
                    </div>
                    
                    <div class="transcription-controls">
                        <div class="control-btn" id="start-transcription">
                            <i class="fas fa-play-circle"></i>
                            <div class="action-title">Start Live Transcription</div>
                        </div>
                        
                        <div class="control-btn" id="upload-audio">
                            <i class="fas fa-upload"></i>
                            <div class="action-title">Upload Audio File</div>
                        </div>
                    </div>
                </div>
                
                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">Session Analysis Summary</h2>
                    </div>
                    <div id="session-analysis">
                        <p>Start a live session to see real-time insights here.</p>
                    </div>
                </div>
            </div>

            <!-- Transcripts Page -->
            <div id="transcripts-page" class="page" style="display: none;">
                <div class="page-header">
                    <h1 class="page-title">Transcript Management</h1>
                    <button class="btn" id="refresh-transcripts">
                        <i class="fas fa-sync-alt"></i> Refresh
                    </button>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">Upload Audio for Transcription</h2>
                    </div>
                    <div class="upload-section">
                        <input type="file" id="audioFile" accept="audio/*" style="margin: 1rem 0;">
                        <button class="btn" onclick="uploadAudioFile()">Upload & Transcribe</button>
                        <div id="uploadStatus"></div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">Latest Transcription Result</h2>
                    </div>
                    <div id="current-transcript" class="transcript-display" style="display: none;">
                        <!-- Will be populated by JavaScript -->
                    </div>
                    <div id="no-current-transcript">
                        <p>Upload an audio file to see transcription results here.</p>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">All Transcripts</h2>
                    </div>
                    <div id="all-transcripts">
                        <p>Loading transcripts...</p>
                    </div>
                </div>
            </div>
            
            <!-- Case Analytics Page -->
            <div id="case-analytics-page" class="page" style="display: none;">
                <div class="page-header">
                    <h1 class="page-title">Case Analytics</h1>
                    <div>
                        <select id="case-select" class="btn-outline" style="padding: 0.5rem;">
                            <option value="CR-2024-01567">State vs. Rajesh Kumar</option>
                            <option value="WP-2024-04557">Public Interest Foundation vs. Union of India</option>
                            <option value="CR-2023-11223">State vs. Meena Singh</option>
                        </select>
                    </div>
                </div>
                
                <!-- Case Header -->
                <div class="case-header">
                    <h1 class="case-title">State vs. Rajesh Kumar</h1>
                    <p class="case-subtitle">Financial Fraud Case • CR-2024-01567 • Hon. Justice Sharma</p>
                    <div class="case-meta">
                        <div class="case-meta-item">
                            <span class="case-meta-label">Status</span>
                            <span class="case-meta-value">In Progress</span>
                        </div>
                        <div class="case-meta-item">
                            <span class="case-meta-label">Hearings</span>
                            <span class="case-meta-value">5</span>
                        </div>
                        <div class="case-meta-item">
                            <span class="case-meta-label">Duration</span>
                            <span class="case-meta-value">12h 45m</span>
                        </div>
                        <div class="case-meta-item">
                            <span class="case-meta-label">Last Hearing</span>
                            <span class="case-meta-value">July 28, 2024</span>
                        </div>
                    </div>
                </div>
                
                <!-- Analysis Tabs -->
                <div class="analysis-tabs">
                    <div class="analysis-tab active" data-tab="overview">Overview</div>
                    <div class="analysis-tab" data-tab="tone">Tone Analysis</div>
                    <div class="analysis-tab" data-tab="speakers">Speaker Insights</div>
                    <div class="analysis-tab" data-tab="precedents">Legal Precedents</div>
                    <div class="analysis-tab" data-tab="advanced">Advanced Analytics</div>
                </div>
                
                <!-- Overview Tab -->
                <div class="analysis-content active" id="overview-tab">
                    <div class="analytics-grid">
                        <div class="chart-container chart-tall">
                            <div class="chart-title">Case Timeline</div>
                            <canvas id="case-timeline-chart"></canvas>
                        </div>
                        
                        <div class="chart-container chart-tall">
                            <div class="chart-title">Hearing Duration Distribution</div>
                            <canvas id="hearing-duration-chart"></canvas>
                        </div>
                    </div>
                    
                    <div class="stats-container">
                        <div class="metric-card">
                            <div class="metric-header">
                                <div class="metric-title">Transcription Accuracy</div>
                                <div class="metric-change positive">
                                    <i class="fas fa-arrow-up"></i> 3.2%
                                </div>
                            </div>
                            <div class="metric-value">94.7%</div>
                            <div class="metric-description">Average confidence across all hearings</div>
                        </div>
                        
                        <div class="metric-card">
                            <div class="metric-header">
                                <div class="metric-title">Key Legal Issues</div>
                                <div class="metric-change neutral">
                                    <i class="fas fa-minus"></i> No change
                                </div>
                            </div>
                            <div class="metric-value">8</div>
                            <div class="metric-description">Distinct legal arguments identified</div>
                        </div>
                        
                        <div class="metric-card">
                            <div class="metric-header">
                                <div class="metric-title">Precedent Citations</div>
                                <div class="metric-change positive">
                                    <i class="fas fa-arrow-up"></i> 2
                                </div>
                            </div>
                            <div class="metric-value">14</div>
                            <div class="metric-description">Legal precedents referenced</div>
                        </div>
                        
                        <div class="metric-card">
                            <div class="metric-header">
                                <div class="metric-title">Emotional Intensity</div>
                                <div class="metric-change negative">
                                    <i class="fas fa-arrow-down"></i> 12%
                                </div>
                            </div>
                            <div class="metric-value">Medium</div>
                            <div class="metric-description">Decreased from previous hearing</div>
                        </div>
                    </div>
                    
                    <div class="insight-card">
                        <div class="insight-header">
                            <div class="insight-icon">
                                <i class="fas fa-lightbulb"></i>
                            </div>
                            <h3 class="insight-title">AI Analysis Summary</h3>
                        </div>
                        <div class="insight-content">
                            <p>The prosecution has maintained a consistent argument strategy focusing on documentary evidence, while the defense has shifted toward challenging procedural aspects. The emotional tone has stabilized after initial volatility, suggesting both parties are settling into their legal positions.</p>
                            <p style="margin-top: 0.5rem;">Key observation: The defense has increasingly cited procedural precedents (up 40% from previous hearings), potentially indicating a strategy shift toward technical legal arguments.</p>
                        </div>
                    </div>
                </div>
                
                <!-- Tone Analysis Tab -->
                <div class="analysis-content" id="tone-tab">
                    <div class="card">
                        <div class="card-header">
                            <h2 class="card-title">Comprehensive Tone Analysis</h2>
                            <button class="btn" id="generate-tone-report">
                                <i class="fas fa-download"></i> Export Tone Report
                            </button>
                        </div>
                        
                        <div class="tone-analysis-grid">
                            <div class="tone-summary-card">
                                <h3 style="color: white; margin-bottom: 1rem;">Overall Sentiment Summary</h3>
                                <div class="tone-metrics">
                                    <div class="tone-metric">
                                        <div class="tone-metric-value" id="overall-sentiment">Neutral</div>
                                        <div class="tone-metric-label">Overall Tone</div>
                                    </div>
                                    <div class="tone-metric">
                                        <div class="tone-metric-value" id="sentiment-score">0.15</div>
                                        <div class="tone-metric-label">Sentiment Score</div>
                                    </div>
                                    <div class="tone-metric">
                                        <div class="tone-metric-value" id="emotional-intensity">Medium</div>
                                        <div class="tone-metric-label">Emotional Intensity</div>
                                    </div>
                                </div>
                                
                                <div class="sentiment-breakdown">
                                    <div class="sentiment-category sentiment-positive">
                                        <div>Positive</div>
                                        <div style="font-size: 1.2rem;">35%</div>
                                    </div>
                                    <div class="sentiment-category sentiment-negative">
                                        <div>Negative</div>
                                        <div style="font-size: 1.2rem;">25%</div>
                                    </div>
                                    <div class="sentiment-category sentiment-neutral">
                                        <div>Neutral</div>
                                        <div style="font-size: 1.2rem;">35%</div>
                                    </div>
                                    <div class="sentiment-category sentiment-mixed">
                                        <div>Mixed</div>
                                        <div style="font-size: 1.2rem;">5%</div>
                                    </div>
                                </div>

                                <!-- Enhanced Tone Visualization -->
                                <div class="tone-visualization">
                                    <h4 style="margin-bottom: 1rem; color: white;">Emotional Tone Distribution</h4>
                                    <div style="margin-bottom: 0.5rem;">
                                        <span style="color: white;">Positive Tone</span>
                                        <div class="tone-bar">
                                            <div class="tone-bar-fill tone-bar-positive" style="width: 35%"></div>
                                        </div>
                                    </div>
                                    <div style="margin-bottom: 0.5rem;">
                                        <span style="color: white;">Negative Tone</span>
                                        <div class="tone-bar">
                                            <div class="tone-bar-fill tone-bar-negative" style="width: 25%"></div>
                                        </div>
                                    </div>
                                    <div style="margin-bottom: 0.5rem;">
                                        <span style="color: white;">Neutral Tone</span>
                                        <div class="tone-bar">
                                            <div class="tone-bar-fill tone-bar-neutral" style="width: 35%"></div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="card">
                                <div class="card-header">
                                    <h3 class="card-title">Key Insights</h3>
                                </div>
                                <div id="tone-insights">
                                    <div style="margin-bottom: 1rem;">
                                        <strong>🔍 Dominant Emotional Patterns:</strong>
                                        <p style="margin: 0.5rem 0; font-size: 0.9rem;">Defense shows higher emotional variation while prosecution maintains formal tone</p>
                                    </div>
                                    <div style="margin-bottom: 1rem;">
                                        <strong>⚠️ Critical Moments:</strong>
                                        <p style="margin: 0.5rem 0; font-size: 0.9rem;">3 emotional peaks detected during cross-examination</p>
                                    </div>
                                    <div>
                                        <strong>📊 Professionalism Score:</strong>
                                        <p style="margin: 0.5rem 0; font-size: 0.9rem;">82% - High level of professional conduct maintained</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="analytics-grid">
                            <div class="chart-container">
                                <div class="chart-title">Tone Timeline Analysis</div>
                                <canvas id="tone-timeline-chart"></canvas>
                            </div>
                            
                            <div class="chart-container">
                                <div class="chart-title">Speaker Tone Comparison</div>
                                <canvas id="speaker-tone-chart"></canvas>
                            </div>
                        </div>
                        
                        <div class="analytics-grid">
                            <div class="chart-container">
                                <div class="chart-title">Emotional Intensity Over Time</div>
                                <canvas id="intensity-chart"></canvas>
                            </div>
                            
                            <div class="chart-container">
                                <div class="chart-title">Sentiment Distribution by Speaker</div>
                                <canvas id="sentiment-distribution-chart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Speaker Insights Tab -->
                <div class="analysis-content" id="speakers-tab">
                    <div class="card">
                        <div class="card-header">
                            <h2 class="card-title">Speaker Analysis</h2>
                        </div>
                        
                        <div class="comparison-grid">
                            <div class="comparison-card">
                                <div class="comparison-title">Speaking Time</div>
                                <div class="comparison-value">42%</div>
                                <div class="comparison-label">Prosecution</div>
                            </div>
                            <div class="comparison-card">
                                <div class="comparison-title">Speaking Time</div>
                                <div class="comparison-value">35%</div>
                                <div class="comparison-label">Defense</div>
                            </div>
                            <div class="comparison-card">
                                <div class="comparison-title">Interruptions</div>
                                <div class="comparison-value comparison-negative">12</div>
                                <div class="comparison-label">Prosecution</div>
                            </div>
                            <div class="comparison-card">
                                <div class="comparison-title">Interruptions</div>
                                <div class="comparison-value comparison-positive">6</div>
                                <div class="comparison-label">Defense</div>
                            </div>
                        </div>
                        
                        <div style="margin-top: 2rem;">
                            <h3 style="margin-bottom: 1rem;">Speaker Highlights</h3>
                            
                            <div class="speaker-highlight">
                                <div class="speaker-avatar">AS</div>
                                <div class="speaker-details">
                                    <div class="speaker-name">Adv. Sameer Joshi</div>
                                    <div class="speaker-role">Prosecution Lead</div>
                                </div>
                                <div class="speaker-stats">
                                    <div class="speaker-stat-value">42%</div>
                                    <div class="speaker-stat-label">Speaking Time</div>
                                </div>
                            </div>
                            
                            <div class="speaker-highlight">
                                <div class="speaker-avatar">PK</div>
                                <div class="speaker-details">
                                    <div class="speaker-name">Adv. Priya Kumar</div>
                                    <div class="speaker-role">Defense Lead</div>
                                </div>
                                <div class="speaker-stats">
                                    <div class="speaker-stat-value">35%</div>
                                    <div class="speaker-stat-label">Speaking Time</div>
                                </div>
                            </div>
                            
                            <div class="speaker-highlight">
                                <div class="speaker-avatar">JS</div>
                                <div class="speaker-details">
                                    <div class="speaker-name">Hon. Justice Sharma</div>
                                    <div class="speaker-role">Presiding Judge</div>
                                </div>
                                <div class="speaker-stats">
                                    <div class="speaker-stat-value">23%</div>
                                    <div class="speaker-stat-label">Speaking Time</div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="analytics-grid">
                        <div class="chart-container">
                            <div class="chart-title">Speaking Time Distribution</div>
                            <canvas id="speaking-time-chart"></canvas>
                        </div>
                        
                        <div class="chart-container">
                            <div class="chart-title">Interruption Frequency</div>
                            <canvas id="interruption-chart"></canvas>
                        </div>
                    </div>
                </div>
                
                <!-- Precedents Tab -->
                <div class="analysis-content" id="precedents-tab">
                    <div class="card">
                        <div class="card-header">
                            <h2 class="card-title">Legal Precedents Analysis</h2>
                        </div>
                        
                        <div class="analytics-grid">
                            <div class="chart-container">
                                <div class="chart-title">Precedent Frequency</div>
                                <canvas id="precedent-chart"></canvas>
                            </div>
                            
                            <div class="chart-container">
                                <div class="chart-title">Precedent Timeline</div>
                                <canvas id="precedent-timeline-chart"></canvas>
                            </div>
                        </div>
                        
                        <div class="insight-card">
                            <div class="insight-header">
                                <div class="insight-icon">
                                    <i class="fas fa-gavel"></i>
                                </div>
                                <h3 class="insight-title">Key Precedent Analysis</h3>
                            </div>
                            <div class="insight-content">
                                <p>The defense has increasingly relied on procedural precedents, particularly <strong>Arnesh Kumar vs. State of Bihar</strong> (cited 5 times) regarding arrest procedures. The prosecution continues to emphasize evidentiary precedents like <strong>Selvi vs. State of Karnataka</strong> regarding admissibility of evidence.</p>
                                <p style="margin-top: 0.5rem;">Notable trend: Recent hearings show a 25% increase in citations of financial fraud precedents, indicating both parties are focusing on substantive legal arguments.</p>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Advanced Analytics Tab -->
                <div class="analysis-content" id="advanced-tab">
                    <div class="analysis-section">
                        <div class="section-header">
                            <h2 class="section-title">Advanced Case Analytics</h2>
                            <div class="section-actions">
                                <button class="btn download-btn">
                                    <i class="fas fa-download"></i> Export Full Report
                                </button>
                            </div>
                        </div>
                        
                        <div class="visualization-grid">
                            <div class="visualization-card">
                                <div class="visualization-header">
                                    <h3 class="visualization-title">Legal Argument Heatmap</h3>
                                </div>
                                <div class="visualization-content">
                                    <div class="heatmap-container">
                                        <canvas id="argument-heatmap-chart"></canvas>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="visualization-card">
                                <div class="visualization-header">
                                    <h3 class="visualization-title">Case Complexity Radar</h3>
                                </div>
                                <div class="visualization-content">
                                    <div class="radar-container">
                                        <canvas id="complexity-radar-chart"></canvas>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="visualization-card">
                                <div class="visualization-header">
                                    <h3 class="visualization-title">Legal Issue Bubble Chart</h3>
                                </div>
                                <div class="visualization-content">
                                    <div class="bubble-container">
                                        <canvas id="issue-bubble-chart"></canvas>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="visualization-card">
                                <div class="visualization-header">
                                    <h3 class="visualization-title">Legal Term Word Cloud</h3>
                                </div>
                                <div class="visualization-content">
                                    <div class="wordcloud-container">
                                        <div class="wordcloud-placeholder">
                                            <i class="fas fa-cloud"></i>
                                            <p>Word Cloud Visualization</p>
                                            <p><small>In a full implementation, this would show frequently used legal terms</small></p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="analysis-section">
                        <div class="section-header">
                            <h2 class="section-title">Predictive Analytics</h2>
                        </div>
                        
                        <div class="chart-row">
                            <div class="chart-container chart-tall">
                                <div class="chart-title">Case Outcome Probability</div>
                                <canvas id="outcome-probability-chart"></canvas>
                            </div>
                            
                            <div class="chart-container chart-tall">
                                <div class="chart-title">Hearing Duration Forecast</div>
                                <canvas id="duration-forecast-chart"></canvas>
                            </div>
                        </div>
                    </div>
                    
                    <div class="analysis-section">
                        <div class="section-header">
                            <h2 class="section-title">Performance Metrics</h2>
                        </div>
                        
                        <div class="visualization-grid">
                            <div class="visualization-card">
                                <div class="stat-highlight">
                                    <div class="stat-highlight-value">87%</div>
                                    <div class="stat-highlight-label">Case Resolution Efficiency</div>
                                    <div class="stat-highlight-change positive">
                                        <i class="fas fa-arrow-up"></i> 5% from last quarter
                                    </div>
                                </div>
                            </div>
                            
                            <div class="visualization-card">
                                <div class="stat-highlight">
                                    <div class="stat-highlight-value">2.3</div>
                                    <div class="stat-highlight-label">Avg. Hearings per Case</div>
                                    <div class="stat-highlight-change negative">
                                        <i class="fas fa-arrow-down"></i> 0.4 from last quarter
                                    </div>
                                </div>
                            </div>
                            
                            <div class="visualization-card">
                                <div class="stat-highlight">
                                    <div class="stat-highlight-value">94%</div>
                                    <div class="stat-highlight-label">AI Accuracy Score</div>
                                    <div class="stat-highlight-change positive">
                                        <i class="fas fa-arrow-up"></i> 3% improvement
                                    </div>
                                </div>
                            </div>
                            
                            <div class="visualization-card">
                                <div class="stat-highlight">
                                    <div class="stat-highlight-value">78%</div>
                                    <div class="stat-highlight-label">Legal Argument Consistency</div>
                                    <div class="stat-highlight-change neutral">
                                        <i class="fas fa-minus"></i> No significant change
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Case History Page -->
            <div id="case-history-page" class="page" style="display: none;">
                <div class="page-header">
                    <h1 class="page-title">Case History</h1>
                </div>
                
                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">Browse and review past and ongoing cases</h2>
                        <input type="text" id="case-search" placeholder="Search by Case Name or ID..." style="padding: 0.5rem; border: 1px solid #ddd; border-radius: 4px;">
                    </div>
                    
                    <table class="data-table" id="case-table">
                        <thead>
                            <tr>
                                <th>Case ID</th>
                                <th>Case Name</th>
                                <th>Date</th>
                                <th>Judge</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>CR-2024-01567</td>
                                <td>State vs. Rajesh Kumar</td>
                                <td>7/28/2024</td>
                                <td>Hon. Justice Sharma</td>
                                <td><span class="status-badge status-in-progress">In Progress</span></td>
                                <td>
                                    <button class="btn btn-outline view-report" data-case="CR-2024-01567">View Report</button>
                                    
                                </td>
                            </tr>
                            <tr>
                                <td>CV-2024-09876</td>
                                <td>Anjali Verma vs. ABC Corp</td>
                                <td>7/27/2024</td>
                                <td>Hon. Justice Gupta</td>
                                <td><span class="status-badge status-adjourned">Adjourned</span></td>
                                <td>
                                    <button class="btn btn-outline view-report" data-case="CV-2024-09876">View Report</button>
                                    
                                </td>
                            </tr>
                            <tr>
                                <td>WP-2024-04567</td>
                                <td>Public Interest Foundation vs. Union of India</td>
                                <td>7/25/2024</td>
                                <td>Hon. Justice Iyer</td>
                                <td><span class="status-badge status-in-progress">In Progress</span></td>
                                <td>
                                    <button class="btn btn-outline view-report" data-case="WP-2024-04567">View Report</button>
                                    
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
            
            <!-- Reports Page -->
            <div id="reports-page" class="page" style="display: none;">
                <div class="page-header">
                    <h1 class="page-title">Reports</h1>
                </div>
                
                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">Generate and Export Reports</h2>
                    </div>
                    
                    <div class="quick-actions">
                        <div class="action-card" id="generate-case-summary">
                            <div class="action-icon">
                                <i class="fas fa-file-pdf"></i>
                            </div>
                            <div class="action-title">Case Summary</div>
                            <div class="action-desc">Generate PDF case summary</div>
                        </div>
                        
                        <div class="action-card" id="generate-analytics-report">
                            <div class="action-icon">
                                <i class="fas fa-chart-line"></i>
                            </div>
                            <div class="action-title">Analytics Report</div>
                            <div class="action-desc">Export analytics data</div>
                        </div>
                        
                        <div class="action-card" id="generate-full-transcript">
                            <div class="action-icon">
                                <i class="fas fa-file-alt"></i>
                            </div>
                            <div class="action-title">Full Transcript</div>
                            <div class="action-desc">Export complete transcript</div>
                        </div>

                        <div class="action-card" id="generate-tone-analysis-report">
                            <div class="action-icon">
                                <i class="fas fa-chart-pie"></i>
                            </div>
                            <div class="action-title">Tone Analysis</div>
                            <div class="action-desc">Detailed sentiment report</div>
                        </div>
                    </div>
                </div>
                
                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">Recent Reports</h2>
                    </div>
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Report Name</th>
                                <th>Case</th>
                                <th>Generated On</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>Case Summary - State vs. Rajesh Kumar</td>
                                <td>CR-2024-01567</td>
                                <td>7/28/2024</td>
                                <td>
                                    <button class="btn download-btn" onclick="downloadReport('Case Summary - State vs. Rajesh Kumar')">
                                        <i class="fas fa-download"></i> Download
                                    </button>
                                    <button class="btn btn-outline" onclick="viewReport('Case Summary - State vs. Rajesh Kumar')">
                                        <i class="fas fa-eye"></i> View
                                    </button>
                                </td>
                            </tr>
                            <tr>
                                <td>Analytics Report - Public Interest Foundation</td>
                                <td>WP-2024-04557</td>
                                <td>7/27/2024</td>
                                <td>
                                    <button class="btn download-btn" onclick="downloadReport('Analytics Report - Public Interest Foundation')">
                                        <i class="fas fa-download"></i> Download
                                    </button>
                                    <button class="btn btn-outline" onclick="viewReport('Analytics Report - Public Interest Foundation')">
                                        <i class="fas fa-eye"></i> View
                                    </button>
                                </td>
                            </tr>
                            <tr>
                                <td>Tone Analysis - State vs. Rajesh Kumar</td>
                                <td>CR-2024-01567</td>
                                <td>7/28/2024</td>
                                <td>
                                    <button class="btn download-btn" onclick="downloadReport('Tone Analysis - State vs. Rajesh Kumar')">
                                        <i class="fas fa-download"></i> Download
                                    </button>
                                    <button class="btn btn-outline" onclick="viewReport('Tone Analysis - State vs. Rajesh Kumar')">
                                        <i class="fas fa-eye"></i> View
                                    </button>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
            
            <!-- Knowledge Graph Page -->
            <div id="knowledge-graph-page" class="page" style="display: none;">
                <div class="page-header">
                    <h1 class="page-title">Knowledge Graph</h1>
                </div>
                
                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">Legal Precedents and Relationships</h2>
                        <button class="btn download-btn" onclick="downloadKnowledgeGraph()">
                            <i class="fas fa-download"></i> Export Graph
                        </button>
                    </div>
                    
                    <div class="knowledge-graph-container" id="knowledge-graph-container">
                        <!-- Knowledge graph will be rendered here by JavaScript -->
                    </div>
                </div>
                
                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">Precedent Details</h2>
                    </div>
                    <div id="precedent-details">
                        <p>Click on a precedent node to view details</p>
                    </div>
                </div>
            </div>
            
            <!-- Chat AI Bot Page -->
            <div id="chat-aibot-page" class="page" style="display: none;">
                <div class="page-header">
                    <h1 class="page-title">Legal AI Assistant</h1>
                </div>
                
                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">Chat with Legal AI Assistant</h2>
                    </div>
                    <p>Hello! I am your legal AI assistant. How can I help you today?</p>
                </div>
                
                <div class="card chat-container">
                    <div class="chat-messages" id="chat-messages">
                        <div class="message bot-message">
                            <p>Hello! I'm your Legal AI Assistant. I can help you with legal queries, case analysis, precedent research, and more. How can I assist you today?</p>
                        </div>
                    </div>
                    
                    <div class="chat-input-container">
                        <input type="text" class="chat-input" id="chat-input" placeholder="Type your legal query here...">
                        <button class="send-btn" id="send-message"><i class="fas fa-paper-plane"></i></button>
                    </div>
                </div>
                
                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">Frequently Asked Questions</h2>
                    </div>
                    
                    <div class="quick-actions">
                        <div class="action-card faq-question" data-question="How do I start a live transcription?">
                            <div class="action-icon">
                                <i class="fas fa-microphone"></i>
                            </div>
                            <div class="action-title">Live Transcription</div>
                            <div class="action-desc">How to start a session</div>
                        </div>
                        
                        <div class="action-card faq-question" data-question="Where are saved transcripts stored?">
                            <div class="action-icon">
                                <i class="fas fa-history"></i>
                            </div>
                            <div class="action-title">Transcript Storage</div>
                            <div class="action-desc">Access saved sessions</div>
                        </div>
                        
                        <div class="action-card faq-question" data-question="What is the AI analysis capability?">
                            <div class="action-icon">
                                <i class="fas fa-chart-bar"></i>
                            </div>
                            <div class="action-title">AI Analysis</div>
                            <div class="action-desc">Understanding AI insights</div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Help Page -->
            <div id="help-page" class="page" style="display: none;">
                <div class="page-header">
                    <h1 class="page-title">Help & Information</h1>
                </div>
                
                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">About AI Court Reporter</h2>
                    </div>
                    <p>This platform leverages state-of-the-art AI to provide real-time transcription, speaker identification, and in-depth legal analysis for court proceedings in India. Our goal is to enhance accuracy, efficiency, and accessibility in the judicial process.</p>
                </div>
                
                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">Frequently Asked Questions</h2>
                    </div>
                    
                    <div style="margin-bottom: 1.5rem;">
                        <h3 style="margin-bottom: 0.5rem;">How do I start a live transcription?</h3>
                        <p>Navigate to Live Transcription and click 'Start Live Transcription'. Grant microphone permissions when prompted.</p>
                    </div>
                    
                    <div style="margin-bottom: 1.5rem;">
                        <h3 style="margin-bottom: 0.5rem;">Where are saved transcripts stored?</h3>
                        <p>All saved sessions are available in the 'Transcripts' page for review and report generation.</p>
                    </div>
                    
                    <div style="margin-bottom: 1.5rem;">
                        <h3 style="margin-bottom: 0.5rem;">What is the AI analysis?</h3>
                        <p>The AI analyzes the transcript for tone, logical fallacies, and cited precedents to provide deeper insights into the proceedings.</p>
                    </div>
                </div>
                
                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">Provide Feedback</h2>
                    </div>
                    <p>Have suggestions to improve the platform? We'd love to hear from you.</p>
                    <textarea id="feedback-text" placeholder="Your feedback..." style="width: 100%; padding: 1rem; margin: 1rem 0; border: 1px solid #ddd; border-radius: 4px; min-height: 120px;"></textarea>
                    <button class="btn" id="submit-feedback">Submit Feedback</button>
                </div>
                
                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">Contact Support</h2>
                    </div>
                    <p>For technical issues or further assistance, please reach out to our support team at <strong>support@aicourtreporter.gov.in</strong>.</p>
                </div>
            </div>
            
            <!-- Admin Page -->
            <div id="admin-page" class="page" style="display: none;">
                <div class="page-header">
                    <h1 class="page-title">Admin Dashboard</h1>
                </div>
                
                <div class="admin-stats">
                    <div class="stat-card">
                        <div class="stat-label">Total Cases</div>
                        <div class="stat-value">5</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">In Progress</div>
                        <div class="stat-value">2</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Closed Cases</div>
                        <div class="stat-value">2</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Active Users</div>
                        <div class="stat-value">12</div>
                    </div>
                </div>
                
                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">System Status</h2>
                    </div>
                    
                    <div class="system-status">
                        <div class="status-item">
                            <div>Transcription Service</div>
                            <div class="status-indicator">
                                <span class="status-dot status-operational"></span>
                                <span>Operational</span>
                            </div>
                        </div>
                        
                        <div class="status-item">
                            <div>AI Analysis Engine</div>
                            <div class="status-indicator">
                                <span class="status-dot status-operational"></span>
                                <span>Operational</span>
                            </div>
                        </div>
                        
                        <div class="status-item">
                            <div>Database</div>
                            <div class="status-indicator">
                                <span class="status-dot status-operational"></span>
                                <span>Operational</span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">User Management</h2>
                        <button class="btn" id="add-user-btn"><i class="fas fa-user-plus"></i> Add New User</button>
                    </div>
                    
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Name</th>
                                <th>Role</th>
                                <th>Last Login</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>Hon. Justice Sharma</td>
                                <td>Judge</td>
                                <td>7/28/2024 09:45</td>
                                <td>Active</td>
                                <td>
                                    <button class="btn btn-outline" onclick="editUser('Hon. Justice Sharma')">Edit</button>
                                    <button class="btn download-btn" onclick="downloadUserDetails('Hon. Justice Sharma')">
                                        <i class="fas fa-download"></i> Export
                                    </button>
                                </td>
                            </tr>
                            <tr>
                                <td>Adv. Priya Singh</td>
                                <td>Lawyer</td>
                                <td>7/28/2024 10:15</td>
                                <td>Active</td>
                                <td>
                                    <button class="btn btn-outline" onclick="editUser('Adv. Priya Singh')">Edit</button>
                                    <button class="btn download-btn" onclick="downloadUserDetails('Adv. Priya Singh')">
                                        <i class="fas fa-download"></i> Export
                                    </button>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal for Viewing Reports -->
    <div id="report-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modal-title">Report Details</h2>
                <button class="modal-close" onclick="closeModal()">&times;</button>
            </div>
            <div id="modal-content">
                <!-- Modal content will be populated here -->
            </div>
        </div>
    </div>

    <script>
        // Enhanced API Service Functions with Backend Integration
        const APIService = {
            baseURL: 'http://localhost:5001',
            
            // Authentication
            async login(role) {
                try {
                    const response = await fetch(`${this.baseURL}/login`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({ role })
                    });
                    
                    if (!response.ok) {
                        throw new Error('Login failed');
                    }
                    
                    return await response.json();
                } catch (error) {
                    console.error('Login error:', error);
                    // Fallback to simulated login
                    return new Promise(resolve => {
                        setTimeout(() => {
                            resolve({
                                success: true,
                                user: {
                                    role: role.charAt(0).toUpperCase() + role.slice(1),
                                    name: role === 'judge' ? 'Hon. Justice Sharma' : 
                                          role === 'lawyer' ? 'Adv. Priya Singh' : 'Clerk User'
                                }
                            });
                        }, 1500);
                    });
                }
            },

            // Enhanced Transcription with Backend Integration
            async uploadAudio(file, caseId = null) {
                const formData = new FormData();
                formData.append('audio_file', file);
                if (caseId) {
                    formData.append('case_id', caseId);
                }

                try {
                    const response = await fetch(`${this.baseURL}/api/transcribe/upload`, {
                        method: 'POST',
                        body: formData
                    });

                    if (!response.ok) {
                        const errorData = await response.json();
                        throw new Error(errorData.error || 'Upload failed');
                    }

                    return await response.json();
                } catch (error) {
                    console.error('Upload error:', error);
                    // Fallback to simulated processing with realistic confidence scores
                    return new Promise(resolve => {
                        setTimeout(() => {
                            const fileName = file.name;
                            const fileId = fileName.replace(/\.[^/.]+$/, "") + '_' + Date.now();
                            const confidence = (0.85 + Math.random() * 0.1).toFixed(2); // Realistic confidence between 0.85-0.95
                            
                            resolve({
                                success: true,
                                file_name: fileName,
                                id: fileId,
                                timestamp: new Date().toISOString(),
                                case_id: caseId || 'default-case',
                                analysis_id: Math.random().toString(36).substring(2, 10),
                                summary: {
                                    total_duration: '120.0',
                                    total_words: 314,
                                    total_segments: 15,
                                    average_confidence: parseFloat(confidence),
                                    quality_metrics: {
                                        transcription_quality: 'High',
                                        speech_clarity: 'Clear',
                                        legal_term_density: 0.15
                                    }
                                },
                                full_transcript: "The court is now in session. Case number CR-1245-2023, State vs. Rajesh Kumar. The prosecution is ready to proceed with witness testimony. The defense is also ready, Your Honor. Very well. Prosecution, you may call your first witness. The prosecution calls Mr. Amit Sharma to the stand. Mr. Sharma, please take the stand and state your full name for the record. My name is Amit Sharma. Mr. Sharma, can you please describe what you witnessed on the evening of October 15th? I was walking home from work around 7 PM when I saw two individuals arguing near the park. Can you identify either of those individuals in this courtroom today? Yes, the defendant, Mr. Kumar, was one of them. Objection, Your Honor. Leading the witness. Sustained. Rephrase your question, counsel.",
                                segments_display: [
                                    {
                                        speaker: "Judge",
                                        text: "The court is now in session. Case number CR-1245-2023, State vs. Rajesh Kumar.",
                                        start_time: "10:00:05",
                                        end_time: "10:00:15",
                                        duration: "10s",
                                        sentiment: { compound: 0.1 },
                                        confidence: (0.9 + Math.random() * 0.05).toFixed(2),
                                        entities: ["Court", "Case"]
                                    },
                                    {
                                        speaker: "Prosecution",
                                        text: "The prosecution is ready to proceed with witness testimony.",
                                        start_time: "10:00:16",
                                        end_time: "10:00:22",
                                        duration: "6s",
                                        sentiment: { compound: 0.3 },
                                        confidence: (0.88 + Math.random() * 0.06).toFixed(2),
                                        entities: ["Prosecution", "Witness"]
                                    },
                                    {
                                        speaker: "Defense",
                                        text: "The defense is also ready, Your Honor.",
                                        start_time: "10:00:23",
                                        end_time: "10:00:28",
                                        duration: "5s",
                                        sentiment: { compound: 0.2 },
                                        confidence: (0.91 + Math.random() * 0.04).toFixed(2),
                                        entities: ["Defense"]
                                    },
                                    {
                                        speaker: "Judge",
                                        text: "Very well. Prosecution, you may call your first witness.",
                                        start_time: "10:00:29",
                                        end_time: "10:00:35",
                                        duration: "6s",
                                        sentiment: { compound: 0.4 },
                                        confidence: (0.93 + Math.random() * 0.03).toFixed(2),
                                        entities: ["Prosecution", "Witness"]
                                    },
                                    {
                                        speaker: "Prosecution",
                                        text: "The prosecution calls Mr. Amit Sharma to the stand.",
                                        start_time: "10:00:36",
                                        end_time: "10:00:42",
                                        duration: "6s",
                                        sentiment: { compound: 0.3 },
                                        confidence: (0.89 + Math.random() * 0.05).toFixed(2),
                                        entities: ["Prosecution", "Witness"]
                                    },
                                    {
                                        speaker: "Judge",
                                        text: "Mr. Sharma, please take the stand and state your full name for the record.",
                                        start_time: "10:00:43",
                                        end_time: "10:00:52",
                                        duration: "9s",
                                        sentiment: { compound: 0.1 },
                                        confidence: (0.92 + Math.random() * 0.03).toFixed(2),
                                        entities: ["Witness"]
                                    },
                                    {
                                        speaker: "Witness",
                                        text: "My name is Amit Sharma.",
                                        start_time: "10:00:53",
                                        end_time: "10:00:56",
                                        duration: "3s",
                                        sentiment: { compound: 0.0 },
                                        confidence: (0.95 + Math.random() * 0.02).toFixed(2),
                                        entities: ["Witness"]
                                    },
                                    {
                                        speaker: "Prosecution",
                                        text: "Mr. Sharma, can you please describe what you witnessed on the evening of October 15th?",
                                        start_time: "10:00:57",
                                        end_time: "10:01:08",
                                        duration: "11s",
                                        sentiment: { compound: 0.2 },
                                        confidence: (0.88 + Math.random() * 0.06).toFixed(2),
                                        entities: ["Witness", "Date"]
                                    },
                                    {
                                        speaker: "Witness",
                                        text: "I was walking home from work around 7 PM when I saw two individuals arguing near the park.",
                                        start_time: "10:01:09",
                                        end_time: "10:01:20",
                                        duration: "11s",
                                        sentiment: { compound: -0.1 },
                                        confidence: (0.87 + Math.random() * 0.07).toFixed(2),
                                        entities: ["Location", "Time"]
                                    },
                                    {
                                        speaker: "Prosecution",
                                        text: "Can you identify either of those individuals in this courtroom today?",
                                        start_time: "10:01:21",
                                        end_time: "10:01:28",
                                        duration: "7s",
                                        sentiment: { compound: 0.3 },
                                        confidence: (0.91 + Math.random() * 0.04).toFixed(2),
                                        entities: ["Courtroom"]
                                    },
                                    {
                                        speaker: "Witness",
                                        text: "Yes, the defendant, Mr. Kumar, was one of them.",
                                        start_time: "10:01:29",
                                        end_time: "10:01:35",
                                        duration: "6s",
                                        sentiment: { compound: 0.1 },
                                        confidence: (0.94 + Math.random() * 0.03).toFixed(2),
                                        entities: ["Defendant"]
                                    },
                                    {
                                        speaker: "Defense",
                                        text: "Objection, Your Honor. Leading the witness.",
                                        start_time: "10:01:36",
                                        end_time: "10:01:41",
                                        duration: "5s",
                                        sentiment: { compound: -0.4 },
                                        confidence: (0.96 + Math.random() * 0.02).toFixed(2),
                                        entities: ["Objection"]
                                    },
                                    {
                                        speaker: "Judge",
                                        text: "Sustained. Rephrase your question, counsel.",
                                        start_time: "10:01:42",
                                        end_time: "10:01:47",
                                        duration: "5s",
                                        sentiment: { compound: -0.2 },
                                        confidence: (0.93 + Math.random() * 0.04).toFixed(2),
                                        entities: ["Ruling"]
                                    }
                                ]
                            });
                        }, 3000);
                    });
                }
            },

            // Transcripts Management
            async getTranscripts() {
                try {
                    const response = await fetch(`${this.baseURL}/api/transcripts`);
                    if (!response.ok) {
                        throw new Error('Failed to fetch transcripts');
                    }
                    return await response.json();
                } catch (error) {
                    console.error('Get transcripts error:', error);
                    // Fallback to simulated data with realistic confidence
                    return new Promise(resolve => {
                        setTimeout(() => {
                            resolve({
                                success: true,
                                transcripts: [
                                    {
                                        id: 'b471fdba-5bf3-42c6-8add-e63d624e3a8b',
                                        file_name: 'court_hearing_2024.wav',
                                        timestamp: '2025-10-26T20:29:59',
                                        case_id: 'CR-2024-01567',
                                        analysis_id: 'e93ec5ff',
                                        summary: {
                                            total_duration: '120.0',
                                            total_words: 314,
                                            total_segments: 15,
                                            average_confidence: 0.92
                                        }
                                    }
                                ]
                            });
                        }, 1000);
                    });
                }
            },

            async getTranscript(transcriptId) {
                try {
                    const response = await fetch(`${this.baseURL}/api/transcripts/${transcriptId}`);
                    if (!response.ok) {
                        throw new Error('Failed to fetch transcript');
                    }
                    return await response.json();
                } catch (error) {
                    console.error('Get transcript error:', error);
                    // Fallback to simulated data with realistic confidence
                    return new Promise(resolve => {
                        setTimeout(() => {
                            resolve({
                                file_name: 'court_hearing_2024.wav',
                                timestamp: new Date().toISOString(),
                                case_id: 'CR-2024-01567',
                                analysis_id: 'e93ec5ff',
                                summary: {
                                    total_duration: '120.0',
                                    total_words: 314,
                                    total_segments: 15,
                                    average_confidence: 0.92
                                },
                                full_transcript: "The court is now in session. Case number CR-1245-2023, State vs. Rajesh Kumar. The prosecution is ready to proceed with witness testimony. The defense is also ready, Your Honor. Very well. Prosecution, you may call your first witness. The prosecution calls Mr. Amit Sharma to the stand. Mr. Sharma, please take the stand and state your full name for the record. My name is Amit Sharma. Mr. Sharma, can you please describe what you witnessed on the evening of October 15th? I was walking home from work around 7 PM when I saw two individuals arguing near the park. Can you identify either of those individuals in this courtroom today? Yes, the defendant, Mr. Kumar, was one of them. Objection, Your Honor. Leading the witness. Sustained. Rephrase your question, counsel.",
                                segments_display: [
                                    {
                                        speaker: "Judge",
                                        text: "The court is now in session. Case number CR-1245-2023, State vs. Rajesh Kumar.",
                                        start_time: "10:00:05",
                                        end_time: "10:00:15",
                                        duration: "10s",
                                        sentiment: { compound: 0.1 },
                                        confidence: "0.95",
                                        entities: ["Court", "Case"]
                                    },
                                    {
                                        speaker: "Prosecution",
                                        text: "The prosecution is ready to proceed with witness testimony.",
                                        start_time: "10:00:16",
                                        end_time: "10:00:22",
                                        duration: "6s",
                                        sentiment: { compound: 0.3 },
                                        confidence: "0.92",
                                        entities: ["Prosecution", "Witness"]
                                    }
                                ]
                            });
                        }, 1000);
                    });
                }
            },

            async deleteTranscript(transcriptId) {
                try {
                    const response = await fetch(`${this.baseURL}/api/transcripts/${transcriptId}`, {
                        method: 'DELETE'
                    });
                    if (!response.ok) {
                        throw new Error('Failed to delete transcript');
                    }
                    return await response.json();
                } catch (error) {
                    console.error('Delete transcript error:', error);
                    // Fallback to simulated success
                    return new Promise(resolve => {
                        setTimeout(() => {
                            resolve({
                                success: true,
                                message: 'Transcript deleted successfully'
                            });
                        }, 1000);
                    });
                }
            },

            // AI Chat with Backend Integration
            async sendChatMessage(message, context = '') {
                try {
                    const response = await fetch(`${this.baseURL}/api/ai_help`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({ query: message, context })
                    });

                    if (!response.ok) {
                        throw new Error('Chat failed');
                    }

                    const data = await response.json();
                    return data;
                } catch (error) {
                    console.error('Chat error:', error);
                    // Fallback to simulated AI response
                    return new Promise(resolve => {
                        const processingTime = 2000 + Math.random() * 1000;
                        
                        setTimeout(() => {
                            let response = "I'm not sure how to answer that. Could you provide more context about your legal question?";
                            
                            if (message.toLowerCase().includes('evidence') || message.toLowerCase().includes('proof')) {
                                response = "In Indian law, evidence must be relevant and admissible. The Indian Evidence Act, 1872 governs what evidence can be presented in court. Evidence can be oral, documentary, or material objects. All evidence must pass tests of relevance and authenticity to be admissible.";
                            } else if (message.toLowerCase().includes('bail') || message.toLowerCase().includes('bailable')) {
                                response = "Bail in India is governed by the Code of Criminal Procedure, 1973. There are two types: bailable and non-bailable offenses. For bailable offenses, bail is a right. For non-bailable offenses, it's at the court's discretion, considering factors like the nature of the offense, evidence, and possibility of the accused fleeing.";
                            }
                            
                            resolve({
                                response: response
                            });
                        }, processingTime);
                    });
                }
            },

            // Reports
            async generateReport(type, caseId) {
                try {
                    const response = await fetch(`${this.baseURL}/api/reports/generate`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({ type, case_id: caseId })
                    });

                    if (!response.ok) {
                        throw new Error('Report generation failed');
                    }

                    return await response.json();
                } catch (error) {
                    console.error('Report generation error:', error);
                    // Fallback to simulated success
                    return new Promise(resolve => {
                        setTimeout(() => {
                            resolve({
                                success: true,
                                download_url: '#',
                                message: `${type} report generated successfully for case ${caseId}`
                            });
                        }, 2000);
                    });
                }
            },

            // Analytics
            async getCaseAnalytics(caseId) {
                try {
                    const response = await fetch(`${this.baseURL}/api/analytics/case/${caseId}`);
                    if (!response.ok) {
                        throw new Error('Failed to fetch analytics');
                    }
                    return await response.json();
                } catch (error) {
                    console.error('Analytics error:', error);
                    // Fallback to simulated data
                    return new Promise(resolve => {
                        setTimeout(() => {
                            resolve({
                                tone_data: {
                                    overall: [0.1, -0.3, 0.2, -0.1, 0.4, -0.2, 0.1],
                                    prosecution: [0.2, -0.4, 0.1, -0.3, 0.3, -0.1, 0.2],
                                    defense: [0.0, -0.2, 0.3, 0.1, 0.5, -0.3, 0.0]
                                }
                            });
                        }, 1000);
                    });
                }
            },

            // Health Check
            async healthCheck() {
                try {
                    const response = await fetch(`${this.baseURL}/api/health`);
                    if (!response.ok) {
                        throw new Error('Health check failed');
                    }
                    return await response.json();
                } catch (error) {
                    console.error('Health check error:', error);
                    return {
                        status: 'unhealthy',
                        error: 'Backend not reachable'
                    };
                }
            }
        };

        // DOM Elements
        const loginPage = document.getElementById('login-page');
        const app = document.getElementById('app');
        const loginBtn = document.getElementById('login-btn');
        const logoutBtn = document.getElementById('logout-btn');
        const roleOptions = document.querySelectorAll('.role-option');
        const navLinks = document.querySelectorAll('.nav-link');
        const pages = document.querySelectorAll('.page');
        
        // Current user role
        let currentRole = 'judge';
        
        // Transcription variables
        let transcriptionInterval;
        let isTranscribing = false;
        let transcriptLines = [];
        let sessionStartTime;
        let currentSessionId = null;
        
        // Socket.io connection
        let socket = null;
        
        // Chart instances
        let toneChart, precedentChart, argumentChart, fallacyChart, toneTimelineChart, speakerToneChart, intensityChart, sentimentDistributionChart, speakingTimeChart;
        
        // Create Ashoka Chakra spokes
        function createAshokaChakra() {
            const chakra = document.getElementById('ashokaChakra');
            const numberOfSpokes = 24;
            
            for (let i = 0; i < numberOfSpokes; i++) {
                const spoke = document.createElement('div');
                spoke.className = 'spoke';
                spoke.style.transform = `rotate(${i * (360 / numberOfSpokes)}deg)`;
                chakra.appendChild(spoke);
            }
        }

        // Initialize Socket Connection
        function initializeSocket() {
            try {
                socket = io(APIService.baseURL);
                
                socket.on('connect', () => {
                    console.log('Connected to server');
                });
                
                socket.on('disconnect', () => {
                    console.log('Disconnected from server');
                });
                
                socket.on('transcription_update', (data) => {
                    console.log('Transcription update:', data);
                    updateTranscriptionStatus(data.status, data.message);
                });
                
                socket.on('transcription_line', (line) => {
                    console.log('New transcription line:', line);
                    addTranscriptionLine(line);
                });
                
                socket.on('connection_status', (data) => {
                    console.log('Connection status:', data.status);
                });
                
            } catch (error) {
                console.error('Socket initialization failed:', error);
            }
        }

        // Role selection
        roleOptions.forEach(option => {
            option.addEventListener('click', () => {
                roleOptions.forEach(opt => opt.style.borderColor = 'rgba(0, 0, 0, 0.1)');
                option.style.borderColor = 'var(--blue)';
                currentRole = option.getAttribute('data-role');
                
                // Update login button text
                const roleText = option.querySelector('.role-name').textContent;
                loginBtn.textContent = `Login as ${roleText} `;
                loginBtn.innerHTML += '<i class="fas fa-arrow-right"></i>';
            });
        });
        
        // Enhanced Login functionality
        loginBtn.addEventListener('click', async () => {
            try {
                // Show enhanced loading state
                loginBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Authenticating...';
                loginBtn.disabled = true;
                
                // Add loading animation to the login card
                const loginCard = document.querySelector('.login-card');
                loginCard.style.position = 'relative';
                
                // Create loading overlay
                const loadingOverlay = document.createElement('div');
                loadingOverlay.style.cssText = `
                    position: absolute;
                    top: 0;
                    left: 0;
                    right: 0;
                    bottom: 0;
                    background: rgba(255, 255, 255, 0.9);
                    display: flex;
                    flex-direction: column;
                    justify-content: center;
                    align-items: center;
                    border-radius: var(--radius);
                    z-index: 10;
                `;
                
                loadingOverlay.innerHTML = `
                    <div style="text-align: center; padding: 2rem;">
                        <div style="font-size: 3rem; color: var(--blue); margin-bottom: 1rem;">
                            <i class="fas fa-balance-scale fa-spin"></i>
                        </div>
                        <h3 style="color: var(--blue); margin-bottom: 0.5rem;">Accessing Judicial Portal</h3>
                        <p style="color: var(--text-dark);">Please wait while we secure your session...</p>
                        <div class="progress-bar" style="width: 80%; margin: 1rem auto;">
                            <div class="progress-fill" style="width: 0%; animation: loadingProgress 2s ease-in-out infinite;"></div>
                        </div>
                    </div>
                `;
                
                loginCard.appendChild(loadingOverlay);

                const result = await APIService.login(currentRole);
                
                // Remove loading overlay
                loginCard.removeChild(loadingOverlay);
                loginCard.style.position = '';
                
                if (result.success) {
                    // Add success animation before transition
                    loginCard.innerHTML += `
                        <div style="position: absolute; top: 0; left: 0; right: 0; bottom: 0; background: rgba(76, 175, 80, 0.9); display: flex; justify-content: center; align-items: center; border-radius: var(--radius); z-index: 20;">
                            <div style="text-align: center; color: white;">
                                <i class="fas fa-check-circle" style="font-size: 4rem; margin-bottom: 1rem;"></i>
                                <h3>Access Granted</h3>
                                <p>Welcome, ${result.user.name}</p>
                            </div>
                        </div>
                    `;
                    
                    // Brief delay to show success message
                    setTimeout(() => {
                        loginPage.style.display = 'none';
                        app.style.display = 'flex';
                        
                        // Update user info based on role
                        document.querySelector('.user-role').textContent = result.user.role;
                        document.querySelector('.user-name').textContent = result.user.name;
                        
                        // Initialize socket connection
                        initializeSocket();
                        
                        // Initialize charts on first login
                        initializeCharts();
                        
                        // Load dashboard data
                        loadDashboardData();
                        
                        // Load cases data
                        loadCasesData();
                        
                        // Perform health check
                        APIService.healthCheck().then(health => {
                            console.log('Backend health:', health);
                        });
                    }, 1500);
                    
                } else {
                    alert('Login failed. Please try again.');
                }
            } catch (error) {
                console.error('Login failed:', error);
                alert('Login failed. Please try again.');
                
                // Remove any loading overlays on error
                const overlays = document.querySelectorAll('.login-card > div');
                overlays.forEach(overlay => {
                    if (overlay.style.position === 'absolute') {
                        overlay.remove();
                    }
                });
            } finally {
                // Reset login button
                const roleText = document.querySelector('.role-option[data-role="' + currentRole + '"] .role-name').textContent;
                loginBtn.innerHTML = `Login as ${roleText} <i class="fas fa-arrow-right"></i>`;
                loginBtn.disabled = false;
            }
        });
        
        // Logout functionality
        logoutBtn.addEventListener('click', () => {
            if (confirm('Are you sure you want to logout?')) {
                app.style.display = 'none';
                loginPage.style.display = 'flex';
                
                // Stop any ongoing transcription
                if (isTranscribing) {
                    stopTranscription();
                }
                
                // Disconnect socket
                if (socket) {
                    socket.disconnect();
                    socket = null;
                }
            }
        });
        
        // Navigation
        navLinks.forEach(link => {
            link.addEventListener('click', (e) => {
                e.preventDefault();
                
                // Update active nav link
                navLinks.forEach(nav => nav.classList.remove('active'));
                link.classList.add('active');
                
                // Show selected page
                const pageId = link.getAttribute('data-page');
                pages.forEach(page => page.style.display = 'none');
                document.getElementById(`${pageId}-page`).style.display = 'block';
                
                // Load data for specific pages
                if (pageId === 'dashboard') {
                    loadDashboardData();
                } else if (pageId === 'transcripts') {
                    loadAllTranscripts();
                } else if (pageId === 'case-analytics') {
                    loadAnalyticsData();
                } else if (pageId === 'case-history') {
                    loadCasesData();
                } else if (pageId === 'admin') {
                    loadAdminData();
                } else if (pageId === 'knowledge-graph') {
                    renderKnowledgeGraph();
                }
                
                // Initialize charts if navigating to analytics page
                if (pageId === 'case-analytics') {
                    initializeCharts();
                }
            });
        });
        
        // Quick actions
        document.querySelectorAll('.action-card').forEach(card => {
            card.addEventListener('click', () => {
                const action = card.getAttribute('data-action');
                if (action) {
                    // Navigate to the corresponding page
                    navLinks.forEach(nav => nav.classList.remove('active'));
                    document.querySelector(`[data-page="${action}"]`).classList.add('active');
                    
                    pages.forEach(page => page.style.display = 'none');
                    document.getElementById(`${action}-page`).style.display = 'block';
                    
                    // Load data for specific pages
                    if (action === 'dashboard') {
                        loadDashboardData();
                    } else if (action === 'transcripts') {
                        loadAllTranscripts();
                    } else if (action === 'case-analytics') {
                        loadAnalyticsData();
                        initializeCharts();
                    } else if (action === 'knowledge-graph') {
                        renderKnowledgeGraph();
                    }
                }
            });
        });
        
        // Join hearing buttons
        document.querySelectorAll('.join-hearing').forEach(button => {
            button.addEventListener('click', () => {
                const caseId = button.getAttribute('data-case');
                alert(`Joining hearing for case ${caseId}. This would connect to the live session in a real implementation.`);
                
                // Navigate to live transcription page
                navLinks.forEach(nav => nav.classList.remove('active'));
                document.querySelector('[data-page="live-transcription"]').classList.add('active');
                pages.forEach(page => page.style.display = 'none');
                document.getElementById('live-transcription-page').style.display = 'block';
            });
        });
        
        // View report buttons
        document.querySelectorAll('.view-report').forEach(button => {
            button.addEventListener('click', async () => {
                const caseId = button.getAttribute('data-case');
                const caseName = button.closest('tr').querySelector('td:nth-child(2)').textContent;
                viewCaseReport(caseId, caseName);
            });
        });
        
        // Transcription controls - Enhanced with backend integration
        document.getElementById('start-transcription').addEventListener('click', startTranscription);
        document.getElementById('stop-transcription').addEventListener('click', stopTranscription);
        document.getElementById('upload-audio').addEventListener('click', uploadAudio);
        
        // Case selection for analytics
        document.getElementById('case-select').addEventListener('change', updateCaseAnalytics);
        
        // Report generation
        document.getElementById('generate-case-summary').addEventListener('click', (e) => generateReport('case-summary', e));
        document.getElementById('generate-analytics-report').addEventListener('click', (e) => generateReport('analytics', e));
        document.getElementById('generate-full-transcript').addEventListener('click', (e) => generateReport('transcript', e));
        document.getElementById('generate-tone-analysis-report').addEventListener('click', (e) => generateReport('tone-analysis', e));
        
        // Feedback submission
        document.getElementById('submit-feedback').addEventListener('click', submitFeedback);
        
        // Case search
        document.getElementById('case-search').addEventListener('input', searchCases);
        
        // Add user button
        document.getElementById('add-user-btn').addEventListener('click', addNewUser);
        
        // Chat functionality
        document.getElementById('send-message').addEventListener('click', sendMessage);
        document.getElementById('chat-input').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                sendMessage();
            }
        });
        
        // FAQ questions
        document.querySelectorAll('.faq-question').forEach(question => {
            question.addEventListener('click', () => {
                const questionText = question.getAttribute('data-question');
                document.getElementById('chat-input').value = questionText;
                sendMessage();
            });
        });

        // Transcripts functionality
        document.getElementById('refresh-transcripts').addEventListener('click', loadAllTranscripts);

        // Analysis tabs
        document.querySelectorAll('.analysis-tab').forEach(tab => {
            tab.addEventListener('click', () => {
                const tabId = tab.getAttribute('data-tab');
                
                // Update active tab
                document.querySelectorAll('.analysis-tab').forEach(t => t.classList.remove('active'));
                tab.classList.add('active');
                
                // Show corresponding content
                document.querySelectorAll('.analysis-content').forEach(content => {
                    content.classList.remove('active');
                });
                document.getElementById(`${tabId}-tab`).classList.add('active');
            });
        });

        // Data Loading Functions
        async function loadDashboardData() {
            try {
                // Update current date
                const currentDate = new Date();
                document.getElementById('current-date').textContent = currentDate.toLocaleDateString('en-IN', { 
                    weekday: 'long', 
                    year: 'numeric', 
                    month: 'long', 
                    day: 'numeric' 
                });
                
                // In a real implementation, this would fetch from an API
                updateDashboardUI({
                    recording_duration: '02:45:32',
                    active_speakers: 4,
                    words_transcribed: 1247,
                    accuracy_score: 89,
                    recent_activity: [
                        'Transcript completed for State vs. Rajesh Kumar',
                        'Tone analysis report generated',
                        'New user added: Adv. Priya Singh'
                    ]
                });
            } catch (error) {
                console.error('Failed to load dashboard data:', error);
            }
        }

        async function loadCasesData() {
            try {
                // In a real implementation, this would fetch from an API
                console.log('Loading cases data...');
            } catch (error) {
                console.error('Failed to load cases data:', error);
            }
        }

        async function loadAnalyticsData() {
            try {
                const caseSelect = document.getElementById('case-select');
                const caseId = caseSelect ? caseSelect.value : 'CR-2024-01567';
                const analytics = await APIService.getCaseAnalytics(caseId);
                updateAnalyticsCharts(analytics);
            } catch (error) {
                console.error('Failed to load analytics data:', error);
            }
        }

        async function loadAdminData() {
            try {
                // In a real implementation, this would fetch from an API
                console.log('Loading admin data...');
            } catch (error) {
                console.error('Failed to load admin data:', error);
            }
        }

        // Enhanced Transcription Functions with Backend Integration
        function startTranscription() {
            if (isTranscribing) return;
            
            try {
                // Show loading state
                document.getElementById('start-transcription').innerHTML = '<i class="fas fa-spinner fa-spin"></i> Starting...';
                
                if (socket && socket.connected) {
                    // Use WebSocket for real-time transcription
                    const sessionId = 'session_' + Date.now();
                    socket.emit('start_transcription', { session_id: sessionId });
                    
                    isTranscribing = true;
                    sessionStartTime = new Date();
                    currentSessionId = sessionId;
                    
                    // Update UI
                    updateTranscriptionStatus('started', 'Live transcription started');
                    
                    document.getElementById('stop-transcription').style.display = 'inline-block';
                    document.getElementById('transcript-placeholder').style.display = 'none';
                    
                    // Clear previous transcript
                    document.getElementById('transcript-container').innerHTML = '';
                    transcriptLines = [];
                    
                } else {
                    // Fallback to simulated transcription
                    startSimulatedTranscription();
                }
                
                // Reset start button
                document.getElementById('start-transcription').innerHTML = '<i class="fas fa-play-circle"></i><div class="action-title">Start Live Transcription</div>';
                
            } catch (error) {
                console.error('Failed to start transcription:', error);
                alert('Failed to start transcription. Please check microphone permissions and try again.');
                
                // Reset start button
                document.getElementById('start-transcription').innerHTML = '<i class="fas fa-play-circle"></i><div class="action-title">Start Live Transcription</div>';
            }
        }

        function stopTranscription() {
            if (!isTranscribing) return;
            
            isTranscribing = false;
            
            if (socket && socket.connected) {
                socket.emit('stop_transcription', { session_id: currentSessionId });
            } else {
                clearInterval(transcriptionInterval);
            }
            
            // Update UI
            updateTranscriptionStatus('stopped', 'Transcription completed');
            
            document.getElementById('stop-transcription').style.display = 'none';
            
            // Generate session analysis
            generateSessionAnalysis();
        }

        function updateTranscriptionStatus(status, message) {
            const statusElement = document.getElementById('transcription-status');
            
            switch(status) {
                case 'started':
                    statusElement.textContent = 'Recording Live';
                    statusElement.className = 'status-badge status-in-progress';
                    statusElement.querySelector('.live-indicator').style.display = 'inline-block';
                    break;
                case 'stopped':
                    statusElement.textContent = 'Completed';
                    statusElement.className = 'status-badge status-closed';
                    statusElement.querySelector('.live-indicator').style.display = 'none';
                    break;
                default:
                    statusElement.textContent = message || 'Not Started';
                    statusElement.className = 'status-badge status-adjourned';
                    statusElement.querySelector('.live-indicator').style.display = 'none';
            }
        }

        function addTranscriptionLine(line) {
            const container = document.getElementById('transcript-container');
            const lineElement = document.createElement('div');
            lineElement.className = `transcript-line speaker-${line.speaker.toLowerCase()}`;
            
            lineElement.innerHTML = `
                <span class="transcript-time">${line.time}</span>
                <span class="speaker-label">${line.speaker}:</span>
                <span>${line.text}</span>
            `;
            
            container.appendChild(lineElement);
            container.scrollTop = container.scrollHeight;
            
            // Add to transcript lines array
            transcriptLines.push(line);
            
            // Update real-time analysis
            updateRealTimeAnalysis(line.speaker, line.text);
        }

        function startSimulatedTranscription() {
            isTranscribing = true;
            sessionStartTime = new Date();
            currentSessionId = 'simulated_' + Date.now();
            
            // Update UI
            updateTranscriptionStatus('started', 'Live transcription started');
            
            document.getElementById('stop-transcription').style.display = 'inline-block';
            document.getElementById('transcript-placeholder').style.display = 'none';
            
            // Clear previous transcript
            document.getElementById('transcript-container').innerHTML = '';
            transcriptLines = [];
            
            // Sample transcript data for simulation
            const sampleTranscript = [
                { speaker: "Judge", text: "The court is now in session. Please state your name for the record.", time: "10:00:05" },
                { speaker: "Defense", text: "My name is Adv. Priya Singh, representing the defendant Rajesh Kumar.", time: "10:00:15" },
                { speaker: "Prosecution", text: "Adv. Rohan Desai for the prosecution, your honor.", time: "10:00:25" },
                { speaker: "Judge", text: "Let the record show that both counsels are present. We will begin with the prosecution's opening statement.", time: "10:00:40" },
                 {speaker: "Judge", text: "Let the record show that both counsels are present. We will begin with the prosecution's opening statement.", time: "10:00:40" },
                {speaker: "Judge", text: "Let the record show that both counsels are present. We will begin with the prosecution's opening statement.", time: "10:00:40" },
                 {speaker: "Judge", text: "Let the record show that both counsels are present. We will begin with the prosecution's opening statement.", time: "10:00:40" },
                 {speaker: "Judge", text: "Let the record show that both counsels are present. We will begin with the prosecution's opening statement.", time: "10:00:40" }

            ];
            
            let lineIndex = 0;
            let currentTime = new Date(sessionStartTime);
            
            transcriptionInterval = setInterval(() => {
                if (lineIndex < sampleTranscript.length) {
                    const line = sampleTranscript[lineIndex];
                    
                    // Update time for this line
                    currentTime = new Date(currentTime.getTime() + 15000);
                    const formattedTime = currentTime.toLocaleTimeString('en-IN', { 
                        hour12: false,
                        hour: '2-digit',
                        minute: '2-digit',
                        second: '2-digit'
                    });
                    
                    line.time = formattedTime;
                    addTranscriptionLine(line);
                    lineIndex++;
                } else {
                    // Stop when all lines are processed
                    stopTranscription();
                }
            }, 3000);
        }

        // Enhanced Transcript Management Functions
        async function uploadAudioFile() {
            const fileInput = document.getElementById('audioFile');
            const statusDiv = document.getElementById('uploadStatus');
            
            if (!fileInput.files[0]) {
                statusDiv.innerHTML = '<div class="upload-error">Please select a file</div>';
                return;
            }

            // Show progress indicator
            statusDiv.innerHTML = `
                <div class="upload-status">
                    <div class="loading-indicator">
                        <i class="fas fa-spinner fa-spin"></i> Processing audio... This may take a few moments.
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: 0%"></div>
                    </div>
                </div>
            `;

            // Simulate progress
            let progress = 0;
            const progressInterval = setInterval(() => {
                progress += 5;
                const progressFill = statusDiv.querySelector('.progress-fill');
                if (progressFill) {
                    progressFill.style.width = `${progress}%`;
                }
                if (progress >= 90) {
                    clearInterval(progressInterval);
                }
            }, 500);

            try {
                const result = await APIService.uploadAudio(fileInput.files[0]);
                
                clearInterval(progressInterval);
                
                if (result.error) {
                    statusDiv.innerHTML = `<div class="upload-error">Upload failed: ${result.error}</div>`;
                } else {
                    statusDiv.innerHTML = `<div class="upload-success">
                        <i class="fas fa-check-circle"></i> Transcription completed successfully!
                        ${result.summary.quality_metrics ? 
                            `<div style="margin-top: 0.5rem;">
                                Quality: <span class="quality-badge quality-${result.summary.quality_metrics.transcription_quality.toLowerCase()}">
                                    ${result.summary.quality_metrics.transcription_quality}
                                </span>
                            </div>` : ''
                        }
                    </div>`;
                    displayTranscript(result);
                    loadAllTranscripts(); // Refresh the list
                }
            } catch (error) {
                console.error('Upload failed:', error);
                statusDiv.innerHTML = `<div class="upload-error">Upload failed: ${error.message}</div>`;
            } finally {
                fileInput.value = ''; // Clear the file input
            }
        }

        function displayTranscript(data) {
            const displayDiv = document.getElementById('current-transcript');
            const noTranscriptDiv = document.getElementById('no-current-transcript');
            
            // Determine quality badge class
            const qualityClass = data.summary.quality_metrics ? 
                `quality-${data.summary.quality_metrics.transcription_quality.toLowerCase()}` : 'quality-high';
            const qualityText = data.summary.quality_metrics ? 
                data.summary.quality_metrics.transcription_quality : 'High';
            
            let html = `
                <div class="card-header">
                    <h3>${data.file_name}</h3>
                    <div>
                        <small>${new Date(data.timestamp).toLocaleString()}</small>
                        <span class="quality-badge ${qualityClass}">${qualityText} Quality</span>
                    </div>
                </div>
                
                <div class="stats-container" style="grid-template-columns: repeat(4, 1fr); margin: 1rem 0;">
                    <div class="stat-card">
                        <div class="stat-label">Duration</div>
                        <div class="stat-value">${data.summary.total_duration}s</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Words</div>
                        <div class="stat-value">${data.summary.total_words}</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Segments</div>
                        <div class="stat-value">${data.summary.total_segments}</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Confidence</div>
                        <div class="stat-value">${(data.summary.average_confidence * 100).toFixed(1)}%</div>
                    </div>
                </div>

                <div style="margin: 1rem 0; text-align: center;">
                    <button class="download-btn" onclick="downloadTranscriptAsPDF('${data.transcript_id || data.analysis_id}', '${data.file_name.replace(/\.[^/.]+$/, "")}')">
                        <i class="fas fa-download"></i> Download Complete Transcript as PDF
                    </button>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h4>Full Transcript</h4>
                    </div>
                    <div style="padding: 1rem; background: #f9f9f9; border-radius: var(--radius); margin: 1rem 0; max-height: 400px; overflow-y: auto;">
                        <p style="white-space: pre-wrap; line-height: 1.5;">${data.full_transcript}</p>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h4>Detailed Analysis</h4>
                    </div>
                    <div id="segments-list">
            `;

            data.segments_display.forEach(segment => {
                const sentimentClass = segment.sentiment.compound > 0.1 ? 'sentiment-positive' : 
                                     segment.sentiment.compound < -0.1 ? 'sentiment-negative' : 'sentiment-neutral';
                
                html += `
                    <div class="segment-card speaker-${segment.speaker.toLowerCase()}">
                        <div class="segment-header">
                            <span class="segment-speaker">${segment.speaker}</span>
                            <span class="segment-time">${segment.start_time} - ${segment.end_time} (${segment.duration})</span>
                        </div>
                        <div class="segment-text">${segment.text}</div>
                        <div class="segment-meta">
                            <span class="${sentimentClass} sentiment-indicator">
                                Sentiment: ${(segment.sentiment.compound * 100).toFixed(1)}%
                            </span>
                            <span>Confidence: ${segment.confidence}</span>
                        </div>
                    </div>
                `;
            });

            html += `</div></div>`;
            displayDiv.innerHTML = html;
            displayDiv.style.display = 'block';
            noTranscriptDiv.style.display = 'none';
        }

        async function loadAllTranscripts() {
            try {
                const response = await APIService.getTranscripts();
                const container = document.getElementById('all-transcripts');
                
                if (response.success && response.transcripts.length > 0) {
                    let html = '<div class="transcript-list">';
                    
                    response.transcripts.forEach(transcript => {
                        const qualityMetrics = transcript.summary?.quality_metrics;
                        const qualityClass = qualityMetrics ? 
                            `quality-${qualityMetrics.transcription_quality.toLowerCase()}` : 'quality-high';
                        const qualityText = qualityMetrics ? 
                            qualityMetrics.transcription_quality : 'High';
                            
                        html += `
                            <div class="segment-card">
                                <div class="segment-header">
                                    <strong>${transcript.file_name}</strong>
                                    <div>
                                        <small>${new Date(transcript.timestamp).toLocaleString()}</small>
                                        <span class="quality-badge ${qualityClass}">${qualityText}</span>
                                    </div>
                                </div>
                                <p><strong>Case ID:</strong> ${transcript.case_id || 'N/A'}</p>
                                <p><strong>Analysis ID:</strong> ${transcript.analysis_id || 'N/A'}</p>
                                <div class="segment-meta">
                                    <span>Duration: ${transcript.summary.total_duration}s</span>
                                    <span>Words: ${transcript.summary.total_words}</span>
                                    <span>Confidence: ${(transcript.summary.average_confidence * 100).toFixed(1)}%</span>
                                </div>
                                <div style="margin-top: 1rem;">
                                    <button class="btn" onclick="viewTranscript('${transcript.id}')">View Details</button>
                                    <button class="btn btn-outline" onclick="deleteTranscript('${transcript.id}')">Delete</button>
                                    <button class="btn download-btn" onclick="downloadTranscriptAsPDF('${transcript.id}', '${transcript.file_name.replace(/\.[^/.]+$/, "")}')">
                                        <i class="fas fa-download"></i> Download PDF
                                    </button>
                                </div>
                            </div>
                        `;
                    });
                    
                    html += '</div>';
                    container.innerHTML = html;
                } else {
                    container.innerHTML = '<p>No transcripts found. Upload an audio file to get started.</p>';
                }
            } catch (error) {
                console.error('Failed to load transcripts:', error);
                document.getElementById('all-transcripts').innerHTML = '<p>Error loading transcripts. Please try again.</p>';
            }
        }

        async function viewTranscript(transcriptId) {
            try {
                const transcript = await APIService.getTranscript(transcriptId);
                displayTranscript(transcript);
                
                // Scroll to the current transcript section
                document.getElementById('current-transcript').scrollIntoView({ behavior: 'smooth' });
            } catch (error) {
                console.error('Failed to load transcript:', error);
                alert('Failed to load transcript details. Please try again.');
            }
        }

        async function deleteTranscript(transcriptId) {
            if (confirm('Are you sure you want to delete this transcript? This action cannot be undone.')) {
                try {
                    const result = await APIService.deleteTranscript(transcriptId);
                    if (result.success) {
                        alert('Transcript deleted successfully.');
                        loadAllTranscripts();
                        
                        // Clear current transcript display if it's the one being deleted
                        const currentDisplay = document.getElementById('current-transcript');
                        const noTranscriptDiv = document.getElementById('no-current-transcript');
                        currentDisplay.style.display = 'none';
                        noTranscriptDiv.style.display = 'block';
                    } else {
                        alert(`Failed to delete transcript: ${result.error}`);
                    }
                } catch (error) {
                    console.error('Failed to delete transcript:', error);
                    alert('Failed to delete transcript. Please try again.');
                }
            }
        }

        // Enhanced PDF Download Function
        async function downloadTranscriptAsPDF(transcriptId, filename = 'transcript') {
            try {
                // Show loading state
                const button = event.target;
                const originalText = button.innerHTML;
                button.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Generating PDF...';
                button.disabled = true;

                // Fetch the PDF from the backend
                const response = await fetch(`${APIService.baseURL}/api/transcripts/${transcriptId}/download-pdf`);
                
                if (!response.ok) {
                    throw new Error('Failed to generate PDF');
                }

                // Create blob and download
                const blob = await response.blob();
                const url = window.URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.style.display = 'none';
                a.href = url;
                a.download = `${filename}.pdf`;
                document.body.appendChild(a);
                a.click();
                window.URL.revokeObjectURL(url);
                document.body.removeChild(a);

                // Restore button
                button.innerHTML = originalText;
                button.disabled = false;
                
            } catch (error) {
                console.error('PDF download failed:', error);
                alert('PDF download failed. Please try again.');
                
                // Restore button even on error
                const button = event.target;
                button.innerHTML = '<i class="fas fa-download"></i> Download PDF';
                button.disabled = false;
            }
        }

        // Enhanced Real-time Analysis Functions
        function updateRealTimeAnalysis(speaker, text) {
            const analysisDiv = document.getElementById('session-analysis');
            
            // Simple real-time analysis update
            const currentLines = transcriptLines.length;
            const wordCount = transcriptLines.reduce((count, line) => count + line.text.split(' ').length, 0);
            
            analysisDiv.innerHTML = `
                <div class="stats-container" style="grid-template-columns: repeat(3, 1fr); margin-bottom: 1rem;">
                    <div class="stat-card">
                        <div class="stat-label">Lines Transcribed</div>
                        <div class="stat-value">${currentLines}</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Word Count</div>
                        <div class="stat-value">${wordCount}</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Current Speaker</div>
                        <div class="stat-value">${speaker}</div>
                    </div>
                </div>
                
                <h3 style="margin-bottom: 1rem;">Real-time Analysis</h3>
                <p><strong>Latest Speaker:</strong> ${speaker}</p>
                <p><strong>Recent Text:</strong> ${text.length > 100 ? text.substring(0, 100) + '...' : text}</p>
                
                <div style="margin-top: 1rem;">
                    <h4>Speaker Activity:</h4>
                    <div style="display: flex; gap: 1rem; flex-wrap: wrap;">
                        ${getSpeakerStats()}
                    </div>
                </div>
            `;
        }

        function getSpeakerStats() {
            const speakerCounts = {};
            transcriptLines.forEach(line => {
                speakerCounts[line.speaker] = (speakerCounts[line.speaker] || 0) + 1;
            });
            
            return Object.entries(speakerCounts)
                .map(([speaker, count]) => 
                    `<span style="background: var(--light-blue); color: white; padding: 0.3rem 0.6rem; border-radius: 15px; font-size: 0.8rem;">
                        ${speaker}: ${count}
                    </span>`
                )
                .join('');
        }

        function generateSessionAnalysis() {
            const analysisDiv = document.getElementById('session-analysis');
            
            const totalLines = transcriptLines.length;
            const speakers = [...new Set(transcriptLines.map(line => line.speaker))];
            const wordCount = transcriptLines.reduce((count, line) => count + line.text.split(' ').length, 0);
            const duration = Math.round(totalLines * 15 / 60); // 15 seconds per line
            
            analysisDiv.innerHTML = `
                <div class="stats-container" style="grid-template-columns: repeat(4, 1fr); margin-bottom: 1rem;">
                    <div class="stat-card">
                        <div class="stat-label">Total Lines</div>
                        <div class="stat-value">${totalLines}</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Unique Speakers</div>
                        <div class="stat-value">${speakers.length}</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Word Count</div>
                        <div class="stat-value">${wordCount}</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Duration</div>
                        <div class="stat-value">${duration} min</div>
                    </div>
                </div>
                
                <h3 style="margin-bottom: 1rem;">Session Analysis Summary</h3>
                
                <div style="margin-top: 1rem;">
                    <h4>Speaker Distribution:</h4>
                    <ul>
                        ${speakers.map(speaker => {
                            const speakerLines = transcriptLines.filter(line => line.speaker === speaker).length;
                            const percentage = ((speakerLines / totalLines) * 100).toFixed(1);
                            return `<li>${speaker}: ${speakerLines} lines (${percentage}%)</li>`;
                        }).join('')}
                    </ul>
                </div>
                
                <div style="margin-top: 1rem;">
                    <button class="download-btn" onclick="downloadSessionTranscript()">
                        <i class="fas fa-download"></i> Download Session Transcript
                    </button>
                </div>
            `;
        }

        function downloadSessionTranscript() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            doc.setFillColor(0, 0, 128);
            doc.rect(0, 0, 210, 30, 'F');
            doc.setTextColor(255, 255, 255);
            doc.setFontSize(16);
            doc.setFont('helvetica', 'bold');
            doc.text('AI Court Reporter - Live Session Transcript', 105, 15, { align: 'center' });
            
            doc.setFillColor(255, 153, 51);
            doc.rect(0, 30, 210, 10, 'F');
            doc.setTextColor(0, 0, 0);
            doc.setFontSize(10);
            doc.text(`Session: ${currentSessionId} | Generated: ${new Date().toLocaleDateString()}`, 105, 36, { align: 'center' });
            
            doc.setTextColor(0, 0, 0);
            doc.setFontSize(11);
            doc.setFont('helvetica', 'normal');
            
            let yPosition = 50;
            const pageHeight = 280;
            const margin = 20;
            const lineHeight = 6;
            
            // Add transcript content
            const transcriptText = transcriptLines.map(line => `[${line.time}] ${line.speaker}: ${line.text}`).join('\n\n');
            const lines = doc.splitTextToSize(transcriptText, 170);
            
            for (let i = 0; i < lines.length; i++) {
                if (yPosition > pageHeight - margin) {
                    doc.addPage();
                    yPosition = margin;
                }
                doc.text(lines[i], margin, yPosition);
                yPosition += lineHeight;
            }
            
            doc.save(`Live_Session_${currentSessionId}.pdf`);
        }

        function uploadAudio() {
            document.getElementById('audioFile').click();
        }

        // Enhanced Tone Analysis Charts
        function initializeEnhancedToneCharts(analyticsData) {
            // Destroy existing charts if they exist
            if (window.toneTimelineChart) window.toneTimelineChart.destroy();
            if (window.speakerToneChart) window.speakerToneChart.destroy();
            if (window.sentimentDistributionChart) window.sentimentDistributionChart.destroy();
            if (window.intensityChart) window.intensityChart.destroy();
            if (window.speakingTimeChart) window.speakingTimeChart.destroy();

            // Tone Timeline Chart
            const toneTimelineCtx = document.getElementById('tone-timeline-chart')?.getContext('2d');
            if (toneTimelineCtx) {
                window.toneTimelineChart = new Chart(toneTimelineCtx, {
                    type: 'line',
                    data: {
                        labels: ['10:00', '10:15', '10:30', '10:45', '11:00', '11:15', '11:30'],
                        datasets: [
                            {
                                label: 'Overall Tone',
                                data: [0.1, -0.3, 0.2, -0.1, 0.4, -0.2, 0.1],
                                borderColor: '#FF9933',
                                backgroundColor: 'rgba(255, 153, 51, 0.1)',
                                tension: 0.4,
                                fill: true
                            },
                            {
                                label: 'Prosecution',
                                data: [0.2, -0.4, 0.1, -0.3, 0.3, -0.1, 0.2],
                                borderColor: '#000080',
                                backgroundColor: 'rgba(0, 0, 128, 0.1)',
                                tension: 0.4,
                                fill: false
                            },
                            {
                                label: 'Defense',
                                data: [0.0, -0.2, 0.3, 0.1, 0.5, -0.3, 0.0],
                                borderColor: '#138808',
                                backgroundColor: 'rgba(19, 136, 8, 0.1)',
                                tension: 0.4,
                                fill: false
                            }
                        ]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            y: {
                                min: -1,
                                max: 1,
                                title: {
                                    display: true,
                                    text: 'Sentiment Score'
                                }
                            },
                            x: {
                                title: {
                                    display: true,
                                    text: 'Time'
                                }
                            }
                        }
                    }
                });
            }

            // Speaker Tone Comparison Chart
            const speakerToneCtx = document.getElementById('speaker-tone-chart')?.getContext('2d');
            if (speakerToneCtx) {
                window.speakerToneChart = new Chart(speakerToneCtx, {
                    type: 'bar',
                    data: {
                        labels: ['Prosecution', 'Defense', 'Judge', 'Witness'],
                        datasets: [
                            {
                                label: 'Positive',
                                data: [45, 30, 60, 25],
                                backgroundColor: '#4CAF50'
                            },
                            {
                                label: 'Negative',
                                data: [25, 40, 10, 15],
                                backgroundColor: '#F44336'
                            },
                            {
                                label: 'Neutral',
                                data: [30, 30, 30, 60],
                                backgroundColor: '#9E9E9E'
                            }
                        ]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            x: {
                                stacked: true
                            },
                            y: {
                                stacked: true,
                                max: 100,
                                title: {
                                    display: true,
                                    text: 'Percentage (%)'
                                }
                            }
                        }
                    }
                });
            }

            // Sentiment Distribution Chart
            const sentimentDistributionCtx = document.getElementById('sentiment-distribution-chart')?.getContext('2d');
            if (sentimentDistributionCtx) {
                window.sentimentDistributionChart = new Chart(sentimentDistributionCtx, {
                    type: 'doughnut',
                    data: {
                        labels: ['Positive', 'Negative', 'Neutral', 'Mixed'],
                        datasets: [{
                            data: [35, 25, 35, 5],
                            backgroundColor: [
                                '#4CAF50',
                                '#F44336',
                                '#9E9E9E',
                                '#FF9800'
                            ]
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false
                    }
                });
            }

            // Emotional Intensity Chart
            const intensityCtx = document.getElementById('intensity-chart')?.getContext('2d');
            if (intensityCtx) {
                window.intensityChart = new Chart(intensityCtx, {
                    type: 'line',
                    data: {
                        labels: ['10:00', '10:10', '10:20', '10:30', '10:40', '10:50', '11:00'],
                        datasets: [{
                            label: 'Emotional Intensity',
                            data: [0.3, 0.7, 0.5, 0.8, 0.4, 0.6, 0.3],
                            borderColor: '#FF6384',
                            backgroundColor: 'rgba(255, 99, 132, 0.1)',
                            tension: 0.4,
                            fill: true
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            y: {
                                min: 0,
                                max: 1,
                                title: {
                                    display: true,
                                    text: 'Intensity Level'
                                }
                            }
                        }
                    }
                });
            }

            // Speaking Time Distribution Chart
            const speakingTimeCtx = document.getElementById('speaking-time-chart')?.getContext('2d');
            if (speakingTimeCtx) {
                window.speakingTimeChart = new Chart(speakingTimeCtx, {
                    type: 'pie',
                    data: {
                        labels: ['Prosecution', 'Defense', 'Judge', 'Witness'],
                        datasets: [{
                            data: [42, 35, 18, 5],
                            backgroundColor: [
                                '#FF9933',
                                '#000080',
                                '#138808',
                                '#FFD700'
                            ]
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false
                    }
                });
            }

            // Case Timeline Chart
            const caseTimelineCtx = document.getElementById('case-timeline-chart')?.getContext('2d');
            if (caseTimelineCtx) {
                window.caseTimelineChart = new Chart(caseTimelineCtx, {
                    type: 'line',
                    data: {
                        labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul'],
                        datasets: [{
                            label: 'Hearing Duration (hours)',
                            data: [1.5, 2.0, 1.2, 2.5, 1.8, 2.2, 1.5],
                            borderColor: '#000080',
                            backgroundColor: 'rgba(0, 0, 128, 0.1)',
                            tension: 0.4,
                            fill: true
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            y: {
                                title: {
                                    display: true,
                                    text: 'Duration (hours)'
                                }
                            }
                        }
                    }
                });
            }

            // Hearing Duration Chart
            const hearingDurationCtx = document.getElementById('hearing-duration-chart')?.getContext('2d');
            if (hearingDurationCtx) {
                window.hearingDurationChart = new Chart(hearingDurationCtx, {
                    type: 'bar',
                    data: {
                        labels: ['Hearing 1', 'Hearing 2', 'Hearing 3', 'Hearing 4', 'Hearing 5'],
                        datasets: [{
                            label: 'Duration (hours)',
                            data: [1.5, 2.0, 1.2, 2.5, 1.8],
                            backgroundColor: [
                                '#FF9933',
                                '#000080',
                                '#138808',
                                '#FFD700',
                                '#534bae'
                            ]
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            y: {
                                title: {
                                    display: true,
                                    text: 'Duration (hours)'
                                }
                            }
                        }
                    }
                });
            }

            // Precedent Chart
            const precedentCtx = document.getElementById('precedent-chart')?.getContext('2d');
            if (precedentCtx) {
                window.precedentChart = new Chart(precedentCtx, {
                    type: 'doughnut',
                    data: {
                        labels: ['Arnesh Kumar', 'DK Basu', 'Selvi', 'Nandini Satpathy', 'Others'],
                        datasets: [{
                            data: [35, 25, 15, 10, 15],
                            backgroundColor: [
                                '#FF9933',
                                '#000080',
                                '#138808',
                                '#FFD700',
                                '#534bae'
                            ]
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false
                    }
                });
            }

            // Precedent Timeline Chart
            const precedentTimelineCtx = document.getElementById('precedent-timeline-chart')?.getContext('2d');
            if (precedentTimelineCtx) {
                window.precedentTimelineChart = new Chart(precedentTimelineCtx, {
                    type: 'line',
                    data: {
                        labels: ['Hearing 1', 'Hearing 2', 'Hearing 3', 'Hearing 4', 'Hearing 5'],
                        datasets: [{
                            label: 'Precedent Citations',
                            data: [2, 3, 5, 4, 6],
                            borderColor: '#138808',
                            backgroundColor: 'rgba(19, 136, 8, 0.1)',
                            tension: 0.4,
                            fill: true
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            y: {
                                title: {
                                    display: true,
                                    text: 'Number of Citations'
                                }
                            }
                        }
                    }
                });
            }

            // Interruption Chart
            const interruptionCtx = document.getElementById('interruption-chart')?.getContext('2d');
            if (interruptionCtx) {
                window.interruptionChart = new Chart(interruptionCtx, {
                    type: 'bar',
                    data: {
                        labels: ['Prosecution', 'Defense', 'Judge'],
                        datasets: [{
                            label: 'Interruptions',
                            data: [12, 6, 2],
                            backgroundColor: [
                                '#FF9933',
                                '#000080',
                                '#138808'
                            ]
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            y: {
                                title: {
                                    display: true,
                                    text: 'Number of Interruptions'
                                }
                            }
                        }
                    }
                });
            }

            // Advanced Analytics Charts
            // Argument Heatmap Chart
            const argumentHeatmapCtx = document.getElementById('argument-heatmap-chart')?.getContext('2d');
            if (argumentHeatmapCtx) {
                window.argumentHeatmapChart = new Chart(argumentHeatmapCtx, {
                    type: 'bar',
                    data: {
                        labels: ['Evidence', 'Procedure', 'Witness', 'Precedent', 'Constitutional'],
                        datasets: [{
                            label: 'Argument Frequency',
                            data: [45, 30, 25, 40, 15],
                            backgroundColor: [
                                'rgba(255, 99, 132, 0.7)',
                                'rgba(54, 162, 235, 0.7)',
                                'rgba(255, 206, 86, 0.7)',
                                'rgba(75, 192, 192, 0.7)',
                                'rgba(153, 102, 255, 0.7)'
                            ]
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            y: {
                                title: {
                                    display: true,
                                    text: 'Frequency'
                                }
                            }
                        }
                    }
                });
            }

            // Complexity Radar Chart
            const complexityRadarCtx = document.getElementById('complexity-radar-chart')?.getContext('2d');
            if (complexityRadarCtx) {
                window.complexityRadarChart = new Chart(complexityRadarCtx, {
                    type: 'radar',
                    data: {
                        labels: ['Legal Issues', 'Evidence', 'Witnesses', 'Precedents', 'Procedural Complexity'],
                        datasets: [{
                            label: 'Case Complexity',
                            data: [85, 70, 60, 75, 80],
                            backgroundColor: 'rgba(54, 162, 235, 0.2)',
                            borderColor: 'rgba(54, 162, 235, 1)',
                            pointBackgroundColor: 'rgba(54, 162, 235, 1)',
                            pointBorderColor: '#fff',
                            pointHoverBackgroundColor: '#fff',
                            pointHoverBorderColor: 'rgba(54, 162, 235, 1)'
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            r: {
                                angleLines: {
                                    display: true
                                },
                                suggestedMin: 0,
                                suggestedMax: 100
                            }
                        }
                    }
                });
            }

            // Issue Bubble Chart
            const issueBubbleCtx = document.getElementById('issue-bubble-chart')?.getContext('2d');
            if (issueBubbleCtx) {
                window.issueBubbleChart = new Chart(issueBubbleCtx, {
                    type: 'bubble',
                    data: {
                        datasets: [{
                            label: 'Legal Issues',
                            data: [
                                {x: 5, y: 8, r: 15},
                                {x: 3, y: 6, r: 10},
                                {x: 7, y: 4, r: 8},
                                {x: 2, y: 9, r: 12},
                                {x: 8, y: 3, r: 6}
                            ],
                            backgroundColor: 'rgba(255, 99, 132, 0.6)',
                            borderColor: 'rgba(255, 99, 132, 1)'
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            x: {
                                title: {
                                    display: true,
                                    text: 'Complexity'
                                }
                            },
                            y: {
                                title: {
                                    display: true,
                                    text: 'Significance'
                                }
                            }
                        }
                    }
                });
            }

            // Outcome Probability Chart
            const outcomeProbabilityCtx = document.getElementById('outcome-probability-chart')?.getContext('2d');
            if (outcomeProbabilityCtx) {
                window.outcomeProbabilityChart = new Chart(outcomeProbabilityCtx, {
                    type: 'doughnut',
                    data: {
                        labels: ['Conviction', 'Acquittal', 'Settlement', 'Adjournment'],
                        datasets: [{
                            data: [45, 25, 20, 10],
                            backgroundColor: [
                                '#FF6384',
                                '#36A2EB',
                                '#FFCE56',
                                '#4BC0C0'
                            ]
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                position: 'bottom'
                            }
                        }
                    }
                });
            }

            // Duration Forecast Chart
            const durationForecastCtx = document.getElementById('duration-forecast-chart')?.getContext('2d');
            if (durationForecastCtx) {
                window.durationForecastChart = new Chart(durationForecastCtx, {
                    type: 'line',
                    data: {
                        labels: ['Week 1', 'Week 2', 'Week 3', 'Week 4', 'Week 5', 'Week 6'],
                        datasets: [{
                            label: 'Actual Duration',
                            data: [2.5, 3.0, 2.2, 2.8, 2.1, 2.6],
                            borderColor: '#36A2EB',
                            backgroundColor: 'rgba(54, 162, 235, 0.1)',
                            tension: 0.4,
                            fill: true
                        }, {
                            label: 'Forecast',
                            data: [null, null, null, null, 2.6, 2.4],
                            borderColor: '#FF6384',
                            borderDash: [5, 5],
                            backgroundColor: 'transparent',
                            tension: 0.4,
                            fill: false
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            y: {
                                title: {
                                    display: true,
                                    text: 'Duration (hours)'
                                }
                            }
                        }
                    }
                });
            }
        }

        function updateCaseAnalytics() {
            const caseSelect = document.getElementById('case-select');
            const selectedCase = caseSelect.options[caseSelect.selectedIndex].text;
            
            document.getElementById('case-analytics-title').textContent = `Judge's View: ${selectedCase}`;
            document.getElementById('case-analytics-subtitle').textContent = `Post-hearing summary for ${selectedCase}`;
            
            loadAnalyticsData();
        }

        function updateAnalyticsCharts(analytics) {
            // Update charts with new data
            if (window.toneTimelineChart && analytics.tone_data) {
                window.toneTimelineChart.data.datasets[0].data = analytics.tone_data.timeline.overall;
                window.toneTimelineChart.data.datasets[1].data = analytics.tone_data.timeline.prosecution;
                window.toneTimelineChart.data.datasets[2].data = analytics.tone_data.timeline.defense;
                window.toneTimelineChart.update();
            }
            
            // Update tone metrics
            updateToneMetrics(analytics);
        }

        function updateToneMetrics(analytics) {
            // Update overall sentiment metrics
            const sentimentBreakdown = analytics.sentiment_distribution;
            if (sentimentBreakdown) {
                document.getElementById('overall-sentiment').textContent = 
                    sentimentBreakdown.positive > sentimentBreakdown.negative ? 'Positive' : 
                    sentimentBreakdown.negative > sentimentBreakdown.positive ? 'Negative' : 'Neutral';
                
                document.getElementById('sentiment-score').textContent = 
                    ((sentimentBreakdown.positive - sentimentBreakdown.negative) / 100).toFixed(2);
                
                // Update sentiment breakdown bars
                document.querySelector('.tone-bar-positive').style.width = `${sentimentBreakdown.positive}%`;
                document.querySelector('.tone-bar-negative').style.width = `${sentimentBreakdown.negative}%`;
                document.querySelector('.tone-bar-neutral').style.width = `${sentimentBreakdown.neutral}%`;
            }
        }

        // Enhanced Chat Functions with Thinking Animation
        async function sendMessage() {
            const input = document.getElementById('chat-input');
            const message = input.value.trim();
            
            if (!message) return;
            
            // Add user message to chat
            addChatMessage('user', message);
            input.value = '';
            input.disabled = true;
            
            // Show enhanced typing indicator with cloud animation
            const typingIndicator = addEnhancedTypingIndicator();
            
            try {
                // Simulate AI thinking time (2-4 seconds)
                const thinkingTime = 2000 + Math.random() * 2000;
                
                setTimeout(async () => {
                    const response = await APIService.sendChatMessage(message);
                    
                    // Remove typing indicator
                    typingIndicator.remove();
                    
                    // Add bot response with fade-in animation
                    addChatMessage('bot', response.response, true);
                    
                    // Re-enable input
                    input.disabled = false;
                    input.focus();
                    
                }, thinkingTime);
                
            } catch (error) {
                console.error('Chat error:', error);
                
                // Remove typing indicator
                typingIndicator.remove();
                
                // Add error message
                addChatMessage('bot', "I'm sorry, I encountered an error processing your request. Please try again.", true);
                
                // Re-enable input
                input.disabled = false;
                input.focus();
            }
        }

        function addEnhancedTypingIndicator() {
            const messagesContainer = document.getElementById('chat-messages');
            const typingElement = document.createElement('div');
            typingElement.className = 'message bot-message';
            typingElement.innerHTML = `
                <div class="typing-indicator">
                    <div class="thinking-cloud">
                        <div class="cloud"></div>
                        <div class="cloud"></div>
                        <div class="cloud"></div>
                    </div>
                    <span class="thinking-text">Legal AI is analyzing your query...</span>
                </div>
            `;
            
            messagesContainer.appendChild(typingElement);
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
            
            return typingElement;
        }

        function addChatMessage(sender, message, withAnimation = false) {
            const messagesContainer = document.getElementById('chat-messages');
            const messageElement = document.createElement('div');
            
            if (withAnimation) {
                messageElement.style.opacity = '0';
                messageElement.style.transform = 'translateY(20px)';
            }
            
            messageElement.className = `message ${sender}-message`;
            messageElement.innerHTML = `<p>${message}</p>`;
            
            messagesContainer.appendChild(messageElement);
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
            
            if (withAnimation) {
                // Animate the message in
                setTimeout(() => {
                    messageElement.style.transition = 'all 0.5s ease';
                    messageElement.style.opacity = '1';
                    messageElement.style.transform = 'translateY(0)';
                }, 100);
            }
        }

        // Enhanced Chart Functions
        function initializeCharts() {
            // Initialize all charts for the analytics page
            initializeEnhancedToneCharts();
        }

        // Other utility functions remain the same...
        function submitFeedback() {
            const feedbackText = document.getElementById('feedback-text').value.trim();
            if (!feedbackText) {
                alert('Please enter your feedback before submitting.');
                return;
            }
            alert('Thank you for your feedback! We appreciate your input.');
            document.getElementById('feedback-text').value = '';
        }

        function searchCases() {
            const searchTerm = document.getElementById('case-search').value.toLowerCase();
            const rows = document.querySelectorAll('#case-table tbody tr');
            rows.forEach(row => {
                const text = row.textContent.toLowerCase();
                row.style.display = text.includes(searchTerm) ? '' : 'none';
            });
        }

        function addNewUser() {
            alert('Add New User functionality would open a user creation form in a real implementation.');
        }

        function updateDashboardUI(stats) {
            // Update stats cards
            const statValues = document.querySelectorAll('.stat-card .stat-value');
            if (statValues[0]) statValues[0].textContent = stats.recording_duration || '02:45:32';
            if (statValues[1]) statValues[1].textContent = stats.active_speakers || 4;
            if (statValues[2]) statValues[2].textContent = stats.words_transcribed || '1,247';
            if (statValues[3]) statValues[3].textContent = `${stats.accuracy_score || 89}%`;
        }

        // Knowledge Graph Functions
        function renderKnowledgeGraph() {
            const container = document.getElementById('knowledge-graph-container');
            container.innerHTML = '';
            
            // Define precedents data
            const precedents = [
                { id: 'arnesh', name: 'Arnesh Kumar vs. State', x: 100, y: 100 },
                { id: 'dkbasu', name: 'DK Basu vs. State', x: 300, y: 80 },
                { id: 'selvi', name: 'Selvi vs. State', x: 200, y: 200 },
                { id: 'nandini', name: 'Nandini Satpathy', x: 80, y: 250 },
                { id: 'maneka', name: 'Maneka Gandhi', x: 320, y: 180 }
            ];
            
            // Create central case node
            const centralNode = document.createElement('div');
            centralNode.className = 'knowledge-graph-node central';
            centralNode.textContent = 'State vs. Rajesh Kumar';
            centralNode.style.left = '200px';
            centralNode.style.top = '150px';
            centralNode.addEventListener('click', () => showPrecedentDetails('central'));
            container.appendChild(centralNode);
            
            // Create precedent nodes
            precedents.forEach(precedent => {
                const node = document.createElement('div');
                node.className = 'knowledge-graph-node precedent';
                node.textContent = precedent.name;
                node.style.left = precedent.x + 'px';
                node.style.top = precedent.y + 'px';
                node.setAttribute('data-id', precedent.id);
                node.addEventListener('click', () => showPrecedentDetails(precedent.id));
                container.appendChild(node);
                
                // Create connection line
                const connection = document.createElement('div');
                connection.className = 'knowledge-graph-connection';
                
                // Calculate line properties
                const dx = precedent.x - 200;
                const dy = precedent.y - 150;
                const length = Math.sqrt(dx * dx + dy * dy);
                const angle = Math.atan2(dy, dx) * 180 / Math.PI;
                
                connection.style.width = length + 'px';
                connection.style.left = '200px';
                connection.style.top = '150px';
                connection.style.transform = `rotate(${angle}deg)`;
                connection.style.height = '2px';
                
                container.appendChild(connection);
            });
        }

        function showPrecedentDetails(precedentId) {
            const detailsContainer = document.getElementById('precedent-details');
            
            // Precedent data
            const precedents = {
                'central': {
                    title: 'State vs. Rajesh Kumar',
                    citation: 'CR-2024-01567',
                    year: '2024',
                    court: 'Supreme Court of India',
                    summary: 'This case involves allegations of financial fraud and misappropriation of funds. The defendant is charged under Sections 420, 406, and 120B of the Indian Penal Code.',
                    keyPoints: [
                        'Primary issue: Interpretation of "cheating" under Section 420 IPC',
                        'Key question: Whether mens rea can be inferred from circumstantial evidence',
                        'Significant procedural history: Multiple adjournments due to witness unavailability'
                    ],
                    citations: [
                        'Arnesh Kumar vs. State of Bihar (2014) 8 SCC 273',
                        'DK Basu vs. State of West Bengal (1997) 1 SCC 416'
                    ]
                },
                'arnesh': {
                    title: 'Arnesh Kumar vs. State of Bihar',
                    citation: '(2014) 8 SCC 273',
                    year: '2014',
                    court: 'Supreme Court of India',
                    summary: 'Landmark judgment on arrest procedures, emphasizing that arrest should not be made in a routine manner. The Court issued guidelines to prevent unnecessary arrests.',
                    keyPoints: [
                        'Police officers must record reasons for arrest in writing',
                        'Magistrates must scrutinize arrest justifications carefully',
                        'No arrest should be made without reasonable satisfaction',
                        'Violation of guidelines may lead to departmental action'
                    ],
                    citations: [
                        'Joginder Kumar vs. State of Uttar Pradesh (1994) 4 SCC 260',
                        'DK Basu vs. State of West Bengal (1997) 1 SCC 416'
                    ]
                }
            };
            
            const precedent = precedents[precedentId] || precedents['central'];
            
            let html = `
                <div class="precedent-details">
                    <div class="precedent-header">
                        <h2 class="precedent-title">${precedent.title}</h2>
                    </div>
                    
                    <div class="precedent-info">
                        <div class="precedent-info-item">
                            <div class="precedent-info-label">Citation</div>
                            <div>${precedent.citation}</div>
                        </div>
                        <div class="precedent-info-item">
                            <div class="precedent-info-label">Year</div>
                            <div>${precedent.year}</div>
                        </div>
                        <div class="precedent-info-item">
                            <div class="precedent-info-label">Court</div>
                            <div>${precedent.court}</div>
                        </div>
                        <div class="precedent-info-item">
                            <div class="precedent-info-label">Significance</div>
                            <div>Landmark Judgment</div>
                        </div>
                    </div>
                    
                    <div class="precedent-summary">
                        <h3>Case Summary</h3>
                        <p>${precedent.summary}</p>
                    </div>
                    
                    <div class="precedent-key-points">
                        <h3>Key Legal Principles</h3>
                        <ul class="key-points-list">
                            ${precedent.keyPoints.map(point => `<li>${point}</li>`).join('')}
                        </ul>
                    </div>
                    
                    <div class="precedent-citations">
                        <h3>Related Citations</h3>
                        ${precedent.citations.map(citation => `
                            <div class="citation-item">${citation}</div>
                        `).join('')}
                    </div>
                    
                    <div class="precedent-actions">
                        <button class="btn download-btn" onclick="downloadPrecedentDetails('${precedentId}')">
                            <i class="fas fa-download"></i> Download Details
                        </button>
                        <button class="btn btn-outline" onclick="viewFullPrecedent('${precedentId}')">
                            <i class="fas fa-external-link-alt"></i> View Full Text
                        </button>
                    </div>
                </div>
            `;
            
            detailsContainer.innerHTML = html;
        }

        function downloadPrecedentDetails(precedentId) {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            doc.setFillColor(0, 0, 128);
            doc.rect(0, 0, 210, 30, 'F');
            doc.setTextColor(255, 255, 255);
            doc.setFontSize(16);
            doc.setFont('helvetica', 'bold');
            doc.text('LEGAL PRECEDENT DETAILS', 105, 15, { align: 'center' });
            
            doc.setFillColor(255, 153, 51);
            doc.rect(0, 30, 210, 10, 'F');
            doc.setTextColor(0, 0, 0);
            doc.setFontSize(10);
            doc.text(`Precedent: ${precedentId}`, 105, 36, { align: 'center' });
            
            doc.setTextColor(0, 0, 0);
            doc.setFontSize(12);
            doc.text('This is a detailed report of the legal precedent.', 20, 60);
            doc.text('In a full implementation, this would include the complete case details.', 20, 70);
            
            doc.save(`${precedentId}_precedent_details.pdf`);
        }

        function viewFullPrecedent(precedentId) {
            alert(`Viewing full text of precedent ${precedentId}. In a full implementation, this would open the complete case text.`);
        }

        // Modal Functions
        function openModal(title, content) {
            document.getElementById('modal-title').textContent = title;
            document.getElementById('modal-content').innerHTML = content;
            document.getElementById('report-modal').style.display = 'flex';
        }

        function closeModal() {
            document.getElementById('report-modal').style.display = 'none';
        }

        // Enhanced Download Functions
        function downloadCaseDetails(caseId, caseName) {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            doc.setFillColor(0, 0, 128);
            doc.rect(0, 0, 210, 30, 'F');
            doc.setTextColor(255, 255, 255);
            doc.setFontSize(16);
            doc.setFont('helvetica', 'bold');
            doc.text('CASE DETAILS REPORT', 105, 15, { align: 'center' });
            
            doc.setFillColor(255, 153, 51);
            doc.rect(0, 30, 210, 10, 'F');
            doc.setTextColor(0, 0, 0);
            doc.setFontSize(10);
            doc.text(`Case: ${caseName} | ID: ${caseId}`, 105, 36, { align: 'center' });
            
            doc.setTextColor(0, 0, 0);
            doc.setFontSize(12);
            let y = 60;
            
            doc.text(`Case ID: ${caseId}`, 20, y); y += 10;
            doc.text(`Case Name: ${caseName}`, 20, y); y += 10;
            doc.text(`Status: In Progress`, 20, y); y += 10;
            doc.text(`Judge: Hon. Justice Sharma`, 20, y); y += 10;
            doc.text(`Date Filed: ${new Date().toLocaleDateString()}`, 20, y); y += 20;
            
            doc.text('Case Summary:', 20, y); y += 10;
            const summary = `This case involves important legal proceedings that have been analyzed by the AI Court Reporter system. The transcript contains detailed arguments from both prosecution and defense, with comprehensive tone analysis and legal precedent references.`;
            doc.text(doc.splitTextToSize(summary, 170), 20, y);
            
            doc.save(`${caseName.replace(/\s+/g, '_')}_details.pdf`);
        }

        function downloadReport(reportName) {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            doc.setFillColor(0, 0, 128);
            doc.rect(0, 0, 210, 30, 'F');
            doc.setTextColor(255, 255, 255);
            doc.setFontSize(16);
            doc.setFont('helvetica', 'bold');
            doc.text('COURT REPORT', 105, 15, { align: 'center' });
            
            doc.setFillColor(255, 153, 51);
            doc.rect(0, 30, 210, 10, 'F');
            doc.setTextColor(0, 0, 0);
            doc.setFontSize(10);
            doc.text(`Report: ${reportName}`, 105, 36, { align: 'center' });
            
            doc.setTextColor(0, 0, 0);
            doc.setFontSize(12);
            doc.text(`This is the ${reportName} generated by AI Court Reporter.`, 20, 60);
            doc.text(`Generated on: ${new Date().toLocaleDateString()}`, 20, 70);
            doc.text(`Confidential - For authorized use only`, 20, 80);
            
            doc.save(`${reportName.replace(/\s+/g, '_')}.pdf`);
        }

        function viewReport(reportName) {
            const content = `
                <div style="padding: 1rem;">
                    <h3>${reportName}</h3>
                    <p><strong>Generated:</strong> ${new Date().toLocaleString()}</p>
                    <p><strong>Status:</strong> Complete</p>
                    <p><strong>Summary:</strong> This report contains comprehensive analysis of the case proceedings, including transcript details, tone analysis, and legal insights.</p>
                    <div style="margin-top: 1rem;">
                        <button class="btn download-btn" onclick="downloadReport('${reportName}')">
                            <i class="fas fa-download"></i> Download Report
                        </button>
                    </div>
                </div>
            `;
            openModal(reportName, content);
        }

        function viewCaseReport(caseId, caseName) {
            const content = `
                <div style="padding: 1rem;">
                    <h3>${caseName}</h3>
                    <p><strong>Case ID:</strong> ${caseId}</p>
                    <p><strong>Status:</strong> In Progress</p>
                    <p><strong>Judge:</strong> Hon. Justice Sharma</p>
                    <p><strong>Last Hearing:</strong> ${new Date().toLocaleDateString()}</p>
                    
                    <div style="margin-top: 1rem;">
                        <h4>Case Summary</h4>
                        <p>This case involves detailed legal arguments and has been thoroughly analyzed by the AI Court Reporter system. Key precedents cited include Arnesh Kumar vs. State of Bihar and DK Basu vs. State of West Bengal.</p>
                    </div>
                    
                    <div style="margin-top: 1rem;">
                        <h4>Available Actions</h4>
                        <div style="display: flex; gap: 0.5rem; flex-wrap: wrap; margin-top: 0.5rem;">
                            <button class="btn download-btn" onclick="downloadCaseDetails('${caseId}', '${caseName}')">
                                <i class="fas fa-download"></i> Download Details
                            </button>
                            <button class="btn btn-outline" onclick="generateCaseReport('${caseId}', '${caseName}')">
                                <i class="fas fa-file-pdf"></i> Generate Full Report
                            </button>
                        </div>
                    </div>
                </div>
            `;
            openModal(`Case Report - ${caseName}`, content);
        }

        function downloadKnowledgeGraph() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            doc.setFillColor(0, 0, 128);
            doc.rect(0, 0, 210, 30, 'F');
            doc.setTextColor(255, 255, 255);
            doc.setFontSize(16);
            doc.setFont('helvetica', 'bold');
            doc.text('LEGAL KNOWLEDGE GRAPH', 105, 15, { align: 'center' });
            
            doc.setFillColor(255, 153, 51);
            doc.rect(0, 30, 210, 10, 'F');
            doc.setTextColor(0, 0, 0);
            doc.setFontSize(10);
            doc.text('Precedents and Case Relationships', 105, 36, { align: 'center' });
            
            doc.setTextColor(0, 0, 0);
            doc.setFontSize(12);
            doc.text('Central Case: State vs. Rajesh Kumar', 20, 60);
            doc.text('Related Precedents:', 20, 80);
            doc.text('• Arnesh Kumar vs. State of Bihar', 30, 90);
            doc.text('• DK Basu vs. State of West Bengal', 30, 100);
            doc.text('• Selvi vs. State of Karnataka', 30, 110);
            doc.text('• Nandini Satpathy vs. P.L. Dani', 30, 120);
            
            doc.save('Legal_Knowledge_Graph.pdf');
        }

        function editUser(userName) {
            alert(`Edit user functionality for ${userName} would open here.`);
        }

        function downloadUserDetails(userName) {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            doc.setFillColor(0, 0, 128);
            doc.rect(0, 0, 210, 30, 'F');
            doc.setTextColor(255, 255, 255);
            doc.setFontSize(16);
            doc.setFont('helvetica', 'bold');
            doc.text('USER DETAILS REPORT', 105, 15, { align: 'center' });
            
            doc.setFillColor(255, 153, 51);
            doc.rect(0, 30, 210, 10, 'F');
            doc.setTextColor(0, 0, 0);
            doc.setFontSize(10);
            doc.text(`User: ${userName}`, 105, 36, { align: 'center' });
            
            doc.setTextColor(0, 0, 0);
            doc.setFontSize(12);
            doc.text(`Name: ${userName}`, 20, 60);
            doc.text(`Role: ${userName.includes('Justice') ? 'Judge' : 'Lawyer'}`, 20, 70);
            doc.text(`Status: Active`, 20, 80);
            doc.text(`Last Login: ${new Date().toLocaleString()}`, 20, 90);
            
            doc.save(`${userName.replace(/\s+/g, '_')}_details.pdf`);
        }

        function generateCaseReport(caseId, caseName) {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            doc.setFillColor(0, 0, 128);
            doc.rect(0, 0, 210, 30, 'F');
            doc.setTextColor(255, 255, 255);
            doc.setFontSize(16);
            doc.setFont('helvetica', 'bold');
            doc.text('COMPREHENSIVE CASE REPORT', 105, 15, { align: 'center' });
            
            doc.setFillColor(255, 153, 51);
            doc.rect(0, 30, 210, 10, 'F');
            doc.setTextColor(0, 0, 0);
            doc.setFontSize(10);
            doc.text(`Case: ${caseName} | ID: ${caseId}`, 105, 36, { align: 'center' });
            
            doc.setTextColor(0, 0, 0);
            doc.setFontSize(12);
            let y = 60;
            
            // Add comprehensive case details
            const sections = [
                'Case Overview',
                'Legal Analysis',
                'Key Precedents',
                'Tone Analysis',
                'Recommendations'
            ];
            
            sections.forEach(section => {
                if (y > 250) {
                    doc.addPage();
                    y = 20;
                }
                doc.setFont('helvetica', 'bold');
                doc.text(section + ':', 20, y);
                y += 10;
                doc.setFont('helvetica', 'normal');
                const content = `This section contains detailed ${section.toLowerCase()} for the case. In a full implementation, this would include specific legal analysis, precedent citations, and AI-generated insights.`;
                const lines = doc.splitTextToSize(content, 170);
                doc.text(lines, 20, y);
                y += lines.length * 7 + 10;
            });
            
            doc.save(`${caseName.replace(/\s+/g, '_')}_full_report.pdf`);
        }

        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            // Create Ashoka Chakra
            createAshokaChakra();
            
            // Set default role selection
            if (roleOptions.length > 0) {
                roleOptions[0].click();
            }
            
            // Load initial transcripts
            loadAllTranscripts();
            
            // Perform initial health check
            APIService.healthCheck().then(health => {
                console.log('Initial health check:', health);
            });
        });

        // Export functions for global access
        window.uploadAudioFile = uploadAudioFile;
        window.viewTranscript = viewTranscript;
        window.deleteTranscript = deleteTranscript;
        window.downloadTranscriptAsPDF = downloadTranscriptAsPDF;
        window.downloadCaseDetails = downloadCaseDetails;
        window.downloadReport = downloadReport;
        window.viewReport = viewReport;
        window.viewCaseReport = viewCaseReport;
        window.downloadKnowledgeGraph = downloadKnowledgeGraph;
        window.editUser = editUser;
        window.downloadUserDetails = downloadUserDetails;
        window.generateCaseReport = generateCaseReport;
        window.closeModal = closeModal;
        window.showPrecedentDetails = showPrecedentDetails;
    </script>
</body>
</html>